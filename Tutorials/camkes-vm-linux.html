<!DOCTYPE html>
<!-- Page last generated 2025-07-25 03:43:43 +0000 -->
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>CAmkES VM Linux | seL4 docs</title>

    <link rel="canonical" href="https://docs.sel4.systems/Tutorials/camkes-vm-linux.html">
    <link href="/assets/css/sel4.css?v=1753415023" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap" rel="stylesheet">
    <link rel="icon" type="image/x-icon" href="/assets/favicon.ico">

    <script defer src="/assets/js/menu.js"></script>
    <script defer src="/assets/js/sidebar.js"></script><script defer data-domain="docs.sel4.systems"
            src="https://analytics.sel4.systems/js/script.js"></script></head>
  <body class="flex flex-row h-screen std-bg text-dark">
    <div id="sidebar" class="hidden lg:flex flex-none w-(--sidebar-width) flex-row bg-f_neutral-50 dark:bg-gray-900">
      <div class="flex-1 overflow-y-auto min-h-full">
        <a href="/">
  <svg xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg" width="84.224365mm" height="32.530689mm" viewBox="0 0 84.224367 32.530689" version="1.1" id="svg5" inkscape:version="1.3.2 (091e20e, 2023-11-25)" sodipodi:docname="sel4-docs.svg" inkscape:export-filename="C:\Users\Birgit Brecknell\Documents\seL4 Foundation\seL4 Summit 2022\sel4_summit_v02.png" inkscape:export-xdpi="96" inkscape:export-ydpi="96" class="px-4 w-50 h-20 mx-auto mt-4 mb-10">
  <sodipodi:namedview id="namedview7" pagecolor="#ffffff" bordercolor="#666666" borderopacity="1.0" inkscape:pageshadow="2" inkscape:pageopacity="0.0" inkscape:pagecheckerboard="0" inkscape:document-units="mm" showgrid="false" inkscape:zoom="1.8116734" inkscape:cx="193.19155" inkscape:cy="87.764163" inkscape:window-width="1392" inkscape:window-height="1099" inkscape:window-x="0" inkscape:window-y="25" inkscape:window-maximized="0" inkscape:current-layer="g18" fit-margin-top="0" fit-margin-left="0" fit-margin-right="0" fit-margin-bottom="0" showguides="true" inkscape:guide-bbox="true" inkscape:showpageshadow="2" inkscape:deskcolor="#d1d1d1"/>
  <defs id="defs2">
    <rect x="680.69342" y="102.26014" width="15.612235" height="115.53054" id="rect9649"/>
    <style id="style824">.cls-1,.cls-2,.cls-3{fill:#96ca4f;}.cls-2,.cls-3{stroke:#96ca4f;stroke-miterlimit:8;}.cls-3{stroke-width:0.25px;}</style>
    <clipPath clipPathUnits="userSpaceOnUse" id="clipPath15">
      <g inkscape:label="Clip" id="use15">
        <path d="m 39.66384,47.73588 h 1.324364 q 0.447983,0 0.68299,0.06854 0.315791,0.09302 0.541007,0.330479 0.225215,0.237455 0.342719,0.582623 0.117503,0.342719 0.117503,0.847005 0,0.443087 -0.110159,0.763774 -0.13464,0.391679 -0.384335,0.63403 -0.188496,0.1836 -0.509183,0.286416 -0.239903,0.07589 -0.641374,0.07589 H 39.66384 Z m 0.724606,0.607103 v 2.377001 h 0.541006 q 0.303551,0 0.438191,-0.03427 0.176255,-0.04406 0.291311,-0.149327 0.117504,-0.105264 0.190944,-0.345168 0.07344,-0.242351 0.07344,-0.65851 0,-0.416159 -0.07344,-0.638926 -0.07344,-0.222767 -0.205632,-0.347615 -0.132192,-0.124848 -0.335375,-0.168912 -0.151776,-0.03427 -0.594862,-0.03427 z m 2.751544,1.209308 q 0,-0.54835 0.164016,-0.920445 0.122399,-0.274175 0.332927,-0.492047 0.212975,-0.217871 0.465118,-0.323135 0.335375,-0.141984 0.773566,-0.141984 0.79315,0 1.268061,0.492047 0.477358,0.492047 0.477358,1.368428 0,0.869038 -0.472462,1.361085 -0.472463,0.489598 -1.263165,0.489598 -0.800494,0 -1.272956,-0.48715 -0.472463,-0.489599 -0.472463,-1.346397 z m 0.746638,-0.02448 q 0,0.609551 0.281519,0.925342 0.281519,0.313343 0.714814,0.313343 0.433295,0 0.709918,-0.310895 0.279072,-0.313343 0.279072,-0.937582 0,-0.616894 -0.271728,-0.920445 -0.269279,-0.303551 -0.717262,-0.303551 -0.447983,0 -0.722158,0.308447 -0.274175,0.305999 -0.274175,0.925341 z m 5.596112,0.477359 0.702574,0.222767 q -0.161567,0.587519 -0.538558,0.873934 -0.374543,0.283967 -0.95227,0.283967 -0.714814,0 -1.175036,-0.48715 -0.460223,-0.489599 -0.460223,-1.336605 0,-0.895965 0.462671,-1.39046 0.46267,-0.496943 1.216652,-0.496943 0.658511,0 1.069773,0.389231 0.2448,0.230112 0.367199,0.660959 l -0.717262,0.171359 q -0.06365,-0.279071 -0.266831,-0.440639 -0.200735,-0.161567 -0.489599,-0.161567 -0.399022,0 -0.648718,0.286415 -0.247247,0.286415 -0.247247,0.927789 0,0.680542 0.244799,0.969406 0.2448,0.288863 0.636478,0.288863 0.288864,0 0.496943,-0.1836 0.20808,-0.183599 0.298655,-0.577726 z m 1.140766,0.151776 0.705022,-0.06854 q 0.06365,0.354959 0.257039,0.521422 0.19584,0.166464 0.526319,0.166464 0.350063,0 0.526318,-0.14688 0.178704,-0.149327 0.178704,-0.347615 0,-0.127295 -0.07589,-0.215423 -0.07344,-0.09058 -0.259487,-0.156672 -0.127296,-0.04406 -0.580175,-0.156671 -0.582622,-0.144432 -0.81763,-0.354959 -0.330479,-0.296208 -0.330479,-0.722158 0,-0.274176 0.154224,-0.511631 0.156671,-0.239903 0.447983,-0.364751 0.293759,-0.124848 0.70747,-0.124848 0.675646,0 1.015917,0.296208 0.342719,0.296207 0.359855,0.790701 l -0.724606,0.03182 q -0.04651,-0.276623 -0.200735,-0.396575 -0.151776,-0.122399 -0.457775,-0.122399 -0.315791,0 -0.494495,0.129743 -0.115056,0.08323 -0.115056,0.222768 0,0.127295 0.107712,0.217871 0.137088,0.115056 0.665854,0.239904 0.528767,0.124847 0.78091,0.259487 0.254591,0.132191 0.396575,0.364751 0.144432,0.230111 0.144432,0.570382 0,0.308447 -0.17136,0.577727 -0.171359,0.269279 -0.484703,0.401471 -0.313343,0.129743 -0.780909,0.129743 -0.680542,0 -1.045293,-0.313343 -0.364751,-0.315791 -0.435743,-0.917997 z" id="path16" style="font-weight:bold;font-stretch:condensed;font-size:5.01349px;font-family:Arial;-inkscape-font-specification:'Arial, Bold Condensed';fill:#96ca4f;stroke-width:0.264583" transform="scale(1.0680757,0.9362632)" aria-label="DOCS"/>
      </g>
    </clipPath>
  </defs>
  <g inkscape:label="Layer 1" inkscape:groupmode="layer" id="layer1" transform="translate(-11.065137,-18.670029)">
    <g id="g18">
      <text xml:space="preserve" transform="scale(0.26458333)" id="text9647" style="font-style:normal;font-weight:normal;font-size:40px;line-height:1.25;font-family:sans-serif;white-space:pre;shape-inside:url(#rect9649);display:inline;fill:#000000;fill-opacity:1;stroke:none"/>
      <g id="Layer_2" data-name="Layer 2" transform="matrix(0.5563179,0,0,0.5563179,-0.00218815,0)">
        <path class="cls-1" d="M 169.29,64.52 V 41.46 h -11.1 l -19.38,23.1 h -5.43 v -28.5 h -10.85 v 28.5 h -5.6 c 0,-0.53 0.08,-1.14 0.08,-1.88 V 62 h -6.77 v 1.94 a 6.32,6.32 0 0 1 -0.37,2.63 1.68,1.68 0 0 1 -1.66,0.88 1.5,1.5 0 0 1 -1.42,-0.71 5,5 0 0 1 -0.32,-2.33 V 58.73 H 117 V 56 a 13,13 0 0 0 -0.85,-5.23 6.31,6.31 0 0 0 -2.92,-2.88 11.68,11.68 0 0 0 -5.43,-1.11 11.49,11.49 0 0 0 -4.76,0.93 5.75,5.75 0 0 0 -2.88,2.57 10.54,10.54 0 0 0 -0.89,4.76 v 7 a 20,20 0 0 0 0.13,2.5 h -3 c 0,-0.28 0,-0.56 0,-0.87 a 5.84,5.84 0 0 0 -1,-3.71 12.59,12.59 0 0 0 -4.47,-2.8 22,22 0 0 1 -3.6,-1.84 3,3 0 0 1 -1.22,-1.32 6,6 0 0 1 -0.19,-1.77 2.32,2.32 0 0 1 0.45,-1.52 1.7,1.7 0 0 1 1.39,-0.58 1.5,1.5 0 0 1 1.49,0.71 5.86,5.86 0 0 1 0.25,2.32 v 1.3 h 6.27 V 53 a 11.15,11.15 0 0 0 -0.2,-2.55 3.72,3.72 0 0 0 -1.08,-1.63 6.68,6.68 0 0 0 -2.67,-1.49 14.3,14.3 0 0 0 -4.38,-0.58 13.32,13.32 0 0 0 -4.54,0.71 5,5 0 0 0 -2.63,1.92 7.84,7.84 0 0 0 -0.78,4 6.85,6.85 0 0 0 0.73,3.28 c 0.47,0.89 1.88,1.93 4.17,3.09 3.84,1.92 4.6,2.43 4.85,2.66 a 3.55,3.55 0 0 1 0.59,2.49 3,3 0 0 1 -0.46,2 A 2,2 0 0 1 87.8,67.45 1.5,1.5 0 0 1 86.3,66.6 6.54,6.54 0 0 1 86,63.87 v -2 h -6.29 v 1.62 c 0,0.38 0,0.72 0,1.05 h -6 a 25.58,25.58 0 1 0 0,8.83 H 158 v 8.42 h 11.33 v -8.4 h 5 V 64.52 Z M 38.89,75.1 A 6.1,6.1 0 1 1 45,69 6.1,6.1 0 0 1 38.89,75.1 Z m 67.54,-20.86 a 7.57,7.57 0 0 1 0.24,-2.68 c 0.15,-0.34 0.53,-0.75 1.48,-0.75 a 1.36,1.36 0 0 1 1.35,0.84 7.39,7.39 0 0 1 0.25,2.59 v 2.23 h -3.32 z M 158,64.52 h -9.62 L 158,52.22 Z" transform="translate(-3.04,-2.5)" id="path858"/>
      </g>
      <text xml:space="preserve" style="font-weight:bold;font-stretch:condensed;font-size:8.61839px;font-family:Arial;-inkscape-font-specification:'Arial, Bold Condensed';fill:none;fill-opacity:1;fill-rule:evenodd;stroke:#000000;stroke-width:0.505292;stroke-opacity:1" x="48.089367" y="45.416836" id="text16" transform="scale(0.93916555,1.064775)"><tspan sodipodi:role="line" id="tspan16" style="fill:#96ca4f;fill-opacity:1;stroke:none;stroke-width:0.505292" x="48.089367" y="45.416836">D</tspan></text>
      <text xml:space="preserve" style="font-weight:bold;font-stretch:condensed;font-size:8.87389px;font-family:Arial;-inkscape-font-specification:'Arial, Bold Condensed';fill:none;fill-opacity:1;fill-rule:evenodd;stroke:#000000;stroke-width:0.505292;stroke-opacity:1" x="54.558205" y="48.250385" id="text16-9"><tspan sodipodi:role="line" id="tspan16-1" style="fill:#96ca4f;fill-opacity:1;stroke:none;stroke-width:0.505292" x="54.558205" y="48.250385">O</tspan></text>
      <g id="g1" transform="matrix(1.1426343,0,0,1.1426343,24.136464,-10.044912)" style="stroke-width:1.67137">
        <text xml:space="preserve" style="font-weight:bold;font-stretch:condensed;font-size:7.7611px;font-family:Arial;-inkscape-font-specification:'Arial, Bold Condensed';fill:none;fill-opacity:1;fill-rule:evenodd;stroke:#000000;stroke-width:0.442217;stroke-opacity:1" x="44.508698" y="51.014606" id="text16-5"><tspan sodipodi:role="line" id="tspan16-8" style="fill:#96ca4f;fill-opacity:1;stroke:none;stroke-width:0.442217" x="44.508698" y="51.014606">S</tspan></text>
      </g>
      <text xml:space="preserve" style="font-weight:bold;font-stretch:condensed;font-size:8.87389px;font-family:Arial;-inkscape-font-specification:'Arial, Bold Condensed';fill:#96ca4f;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:0.505292;stroke-opacity:1" x="65.022789" y="48.250385" id="text17"><tspan sodipodi:role="line" id="tspan17" style="stroke-width:0.505292" x="65.022789" y="48.250385">C</tspan></text>
    </g>
  </g>
</svg>
</a>

<ul class="px-4 my-10 ext-links">
  <li class="mt-1">
    <div class=" mb-1 menu-title hover:text-hi leading-none">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true" data-slot="icon" class="menu-chevron p-0 h-4 w-4 mb-px -mr-0.5 inline cursor-pointer rotate-270">
  <path fill-rule="evenodd" d="M5.22 8.22a.75.75 0 0 1 1.06 0L10 11.94l3.72-3.72a.75.75 0 1 1 1.06 1.06l-4.25 4.25a.75.75 0 0 1-1.06 0L5.22 9.28a.75.75 0 0 1 0-1.06Z" clip-rule="evenodd"/>
</svg>
      <span class="cursor-pointer text-sm">Getting Started</span>
    </div>
    <ul class="menu-content ml-6 ">
        <li class="text-light bordercol pb-1 pl-3 border-l-1 text-sm leading-5 hover:text-hi">
          <a href="/getting-started.html">Overview</a>
        </li>
        <li class="text-light bordercol pb-1 pl-3 border-l-1 text-sm leading-5 hover:text-hi">
          <a href="/Tutorials/">Tutorials</a>
        </li>
        <li class="text-light bordercol pb-1 pl-3 border-l-1 text-sm leading-5 hover:text-hi">
          <a href="/projects/dockerfiles/">Setting up with Docker</a>
        </li>
        <li class="text-light bordercol pb-1 pl-3 border-l-1 text-sm leading-5 hover:text-hi">
          <a href="/projects/buildsystem/repo-cheatsheet.html">Repo manifest cheat sheet</a>
        </li>
    </ul>
  </li>
  <li class="mt-1">
    <div class=" mb-1 menu-title hover:text-hi leading-none">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true" data-slot="icon" class="menu-chevron p-0 h-4 w-4 mb-px -mr-0.5 inline cursor-pointer rotate-270">
  <path fill-rule="evenodd" d="M5.22 8.22a.75.75 0 0 1 1.06 0L10 11.94l3.72-3.72a.75.75 0 1 1 1.06 1.06l-4.25 4.25a.75.75 0 0 1-1.06 0L5.22 9.28a.75.75 0 0 1 0-1.06Z" clip-rule="evenodd"/>
</svg>
      <span class="cursor-pointer text-sm">The seL4 Kernel</span>
    </div>
    <ul class="menu-content ml-6 ">
        <li class="text-light bordercol pb-1 pl-3 border-l-1 text-sm leading-5 hover:text-hi">
          <a href="/projects/sel4/">Overview</a>
        </li>
        <li class="text-light bordercol pb-1 pl-3 border-l-1 text-sm leading-5 hover:text-hi">
          <a href="/projects/buildsystem/host-dependencies.html">Setting up</a>
        </li>
      <li class="pl-3 pb-1 border-l-1 bordercol">
        <div class="text-sm  menu-title text-light hover:text-hi">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true" data-slot="icon" class="menu-chevron h-4 w-4 mb-0.5 -ml-2 -mr-0.5 inline cursor-pointer rotate-270">
  <path fill-rule="evenodd" d="M5.22 8.22a.75.75 0 0 1 1.06 0L10 11.94l3.72-3.72a.75.75 0 1 1 1.06 1.06l-4.25 4.25a.75.75 0 0 1-1.06 0L5.22 9.28a.75.75 0 0 1 0-1.06Z" clip-rule="evenodd"/>
</svg>
          <span class="cursor-pointer">Tutorial</span>
        </div>
        <ul class="menu-content ml-3 ">
            <li class="text-light bordercol pl-3 border-l-1 text-sm leading-5 hover:text-hi">
              <a href="/Tutorials/setting-up.html">Setting up</a>
            </li>
            <li class="text-light bordercol pl-3 border-l-1 text-sm leading-5 hover:text-hi">
              <a href="/Tutorials/get-the-tutorials.html">Getting the tutorials</a>
            </li>
            <li class="text-light bordercol pl-3 border-l-1 text-sm leading-5 hover:text-hi">
              <a href="/Tutorials/hello-world.html">Hello world</a>
            </li>
            <li class="text-light bordercol pl-3 border-l-1 text-sm leading-5 hover:text-hi">
              <a href="/Tutorials/capabilities.html">Capabilities</a>
            </li>
            <li class="text-light bordercol pl-3 border-l-1 text-sm leading-5 hover:text-hi">
              <a href="/Tutorials/untyped.html">Untyped</a>
            </li>
            <li class="text-light bordercol pl-3 border-l-1 text-sm leading-5 hover:text-hi">
              <a href="/Tutorials/mapping.html">Mapping</a>
            </li>
            <li class="text-light bordercol pl-3 border-l-1 text-sm leading-5 hover:text-hi">
              <a href="/Tutorials/threads.html">Threads</a>
            </li>
            <li class="text-light bordercol pl-3 border-l-1 text-sm leading-5 hover:text-hi">
              <a href="/Tutorials/ipc.html">IPC</a>
            </li>
            <li class="text-light bordercol pl-3 border-l-1 text-sm leading-5 hover:text-hi">
              <a href="/Tutorials/notifications.html">Notifications</a>
            </li>
            <li class="text-light bordercol pl-3 border-l-1 text-sm leading-5 hover:text-hi">
              <a href="/Tutorials/interrupts.html">Interrupts</a>
            </li>
            <li class="text-light bordercol pl-3 border-l-1 text-sm leading-5 hover:text-hi">
              <a href="/Tutorials/fault-handlers.html">Fault handling</a>
            </li>
            <li class="text-light bordercol pl-3 border-l-1 text-sm leading-5 hover:text-hi">
              <a href="/Tutorials/mcs.html">MCS</a>
            </li>
            <li class="text-light bordercol pl-3 border-l-1 text-sm leading-5 hover:text-hi">
              <a href="/Tutorials/seL4-end.html">End</a>
            </li>
        </ul>
      </li>
        <li class="text-light bordercol pb-1 pl-3 border-l-1 text-sm leading-5 hover:text-hi">
          <a href="/Tutorials/how-to-seL4.html">How-to</a>
        </li>
        <li class="text-light bordercol pb-1 pl-3 border-l-1 text-sm leading-5 hover:text-hi">
          <a href="/projects/sel4/api-doc.html">API docs</a>
        </li>
        <li class="text-light bordercol pb-1 pl-3 border-l-1 text-sm leading-5 hover:text-hi">
          <a href="/projects/sel4/manual.html">Manual</a>
        </li>
        <li class="text-light bordercol pb-1 pl-3 border-l-1 text-sm leading-5 hover:text-hi">
          <a href="/Hardware/">Supported platforms</a>
        </li>
        <li class="text-light bordercol pb-1 pl-3 border-l-1 text-sm leading-5 hover:text-hi">
          <a href="/projects/sel4/verified-configurations.html">Verified configurations</a>
        </li>
        <li class="text-light bordercol pb-1 pl-3 border-l-1 text-sm leading-5 hover:text-hi">
          <a href="/projects/sel4/configurations.html">Configurations</a>
        </li>
        <li class="text-light bordercol pb-1 pl-3 border-l-1 text-sm leading-5 hover:text-hi">
          <a href="/projects/buildsystem/standalone.html">Standalone seL4 builds</a>
        </li>
        <li class="text-light bordercol pb-1 pl-3 border-l-1 text-sm leading-5 hover:text-hi">
          <a href="/projects/sel4/bfgen.html">Bitfield generator</a>
        </li>
      <li class="pl-3 pb-1 border-l-1 bordercol">
        <div class="text-sm  menu-title text-light hover:text-hi">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true" data-slot="icon" class="menu-chevron h-4 w-4 mb-0.5 -ml-2 -mr-0.5 inline cursor-pointer rotate-270">
  <path fill-rule="evenodd" d="M5.22 8.22a.75.75 0 0 1 1.06 0L10 11.94l3.72-3.72a.75.75 0 1 1 1.06 1.06l-4.25 4.25a.75.75 0 0 1-1.06 0L5.22 9.28a.75.75 0 0 1 0-1.06Z" clip-rule="evenodd"/>
</svg>
          <span class="cursor-pointer">Testing &amp; benchmarking</span>
        </div>
        <ul class="menu-content ml-3 ">
            <li class="text-light bordercol pl-3 border-l-1 text-sm leading-5 hover:text-hi">
              <a href="/projects/sel4test/">seL4test</a>
            </li>
            <li class="text-light bordercol pl-3 border-l-1 text-sm leading-5 hover:text-hi">
              <a href="/projects/sel4-tutorials/debugging-guide.html">Debugging guide</a>
            </li>
            <li class="text-light bordercol pl-3 border-l-1 text-sm leading-5 hover:text-hi">
              <a href="/projects/sel4-tutorials/debugging-userspace.html">Debugging user space</a>
            </li>
            <li class="text-light bordercol pl-3 border-l-1 text-sm leading-5 hover:text-hi">
              <a href="/projects/sel4bench/">sel4bench</a>
            </li>
            <li class="text-light bordercol pl-3 border-l-1 text-sm leading-5 hover:text-hi">
              <a href="/projects/sel4-tutorials/benchmarking-guide.html">Benchmarking guide</a>
            </li>
        </ul>
      </li>
        <li class="text-light bordercol pb-1 pl-3 border-l-1 text-sm leading-5 hover:text-hi">
          <a href="/projects/sel4/kernel-contribution.html">Contributing</a>
        </li>
        <li class="text-light bordercol pb-1 pl-3 border-l-1 text-sm leading-5 hover:text-hi">
          <a href="/projects/sel4/porting.html">Porting to a new platform</a>
        </li>
        <li class="text-light bordercol pb-1 pl-3 border-l-1 text-sm leading-5 hover:text-hi">
          <a href="/releases/seL4.html">Releases</a>
        </li>
        <li class="text-light bordercol pb-1 pl-3 border-l-1 text-sm leading-5 hover:text-hi">
          <a href="https://github.com/seL4/seL4">Sources</a>
        </li>
    </ul>
  </li>
<li class="-mt-2">&nbsp;</li>
  <li class="mt-1">
    <div class=" mb-1 menu-title hover:text-hi leading-none">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true" data-slot="icon" class="menu-chevron p-0 h-4 w-4 mb-px -mr-0.5 inline cursor-pointer rotate-270">
  <path fill-rule="evenodd" d="M5.22 8.22a.75.75 0 0 1 1.06 0L10 11.94l3.72-3.72a.75.75 0 1 1 1.06 1.06l-4.25 4.25a.75.75 0 0 1-1.06 0L5.22 9.28a.75.75 0 0 1 0-1.06Z" clip-rule="evenodd"/>
</svg>
      <span class="cursor-pointer text-sm">Microkit</span>
    </div>
    <ul class="menu-content ml-6 ">
        <li class="text-light bordercol pb-1 pl-3 border-l-1 text-sm leading-5 hover:text-hi">
          <a href="/projects/microkit/">Overview</a>
        </li>
        <li class="text-light bordercol pb-1 pl-3 border-l-1 text-sm leading-5 hover:text-hi">
          <a href="/projects/microkit/setting-up.html">Setting up your machine</a>
        </li>
      <li class="pl-3 pb-1 border-l-1 bordercol">
        <div class="text-sm  menu-title text-light hover:text-hi">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true" data-slot="icon" class="menu-chevron h-4 w-4 mb-0.5 -ml-2 -mr-0.5 inline cursor-pointer rotate-270">
  <path fill-rule="evenodd" d="M5.22 8.22a.75.75 0 0 1 1.06 0L10 11.94l3.72-3.72a.75.75 0 1 1 1.06 1.06l-4.25 4.25a.75.75 0 0 1-1.06 0L5.22 9.28a.75.75 0 0 1 0-1.06Z" clip-rule="evenodd"/>
</svg>
          <span class="cursor-pointer">Tutorial</span>
        </div>
        <ul class="menu-content ml-3 ">
            <li class="text-light bordercol pl-3 border-l-1 text-sm leading-5 hover:text-hi">
              <a href="/projects/microkit/tutorial/welcome.html">Welcome</a>
            </li>
            <li class="text-light bordercol pl-3 border-l-1 text-sm leading-5 hover:text-hi">
              <a href="/projects/microkit/tutorial/part0.html">Part 0 - Setting up</a>
            </li>
            <li class="text-light bordercol pl-3 border-l-1 text-sm leading-5 hover:text-hi">
              <a href="/projects/microkit/tutorial/part1.html">Part 1 - Serial server</a>
            </li>
            <li class="text-light bordercol pl-3 border-l-1 text-sm leading-5 hover:text-hi">
              <a href="/projects/microkit/tutorial/part2.html">Part 2 - Client</a>
            </li>
            <li class="text-light bordercol pl-3 border-l-1 text-sm leading-5 hover:text-hi">
              <a href="/projects/microkit/tutorial/part3.html">Part 3 - Wordle server</a>
            </li>
            <li class="text-light bordercol pl-3 border-l-1 text-sm leading-5 hover:text-hi">
              <a href="/projects/microkit/tutorial/part4.html">Part 4 - Virtual machines</a>
            </li>
            <li class="text-light bordercol pl-3 border-l-1 text-sm leading-5 hover:text-hi">
              <a href="/projects/microkit/tutorial/end.html">End</a>
            </li>
        </ul>
      </li>
        <li class="text-light bordercol pb-1 pl-3 border-l-1 text-sm leading-5 hover:text-hi">
          <a href="/projects/microkit/manual/latest/">Manual</a>
        </li>
        <li class="text-light bordercol pb-1 pl-3 border-l-1 text-sm leading-5 hover:text-hi">
          <a href="/projects/microkit/roadmap.html">Roadmap</a>
        </li>
        <li class="text-light bordercol pb-1 pl-3 border-l-1 text-sm leading-5 hover:text-hi">
          <a href="/projects/microkit/platforms.html">Supported platforms</a>
        </li>
        <li class="text-light bordercol pb-1 pl-3 border-l-1 text-sm leading-5 hover:text-hi">
          <a href="/releases/microkit.html">Releases</a>
        </li>
        <li class="text-light bordercol pb-1 pl-3 border-l-1 text-sm leading-5 hover:text-hi">
          <a href="https://github.com/seL4/microkit">Sources</a>
        </li>
    </ul>
  </li>
  <li class="mt-1">
    <div class="font-bold mb-1 menu-title hover:text-hi leading-none">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true" data-slot="icon" class="menu-chevron p-0 h-4 w-4 mb-px -mr-0.5 inline cursor-pointer ">
  <path fill-rule="evenodd" d="M5.22 8.22a.75.75 0 0 1 1.06 0L10 11.94l3.72-3.72a.75.75 0 1 1 1.06 1.06l-4.25 4.25a.75.75 0 0 1-1.06 0L5.22 9.28a.75.75 0 0 1 0-1.06Z" clip-rule="evenodd"/>
</svg>
      <span class="cursor-pointer text-sm">CAmkES</span>
    </div>
    <ul class="menu-content ml-6 on">
        <li class="text-light bordercol pb-1 pl-3 border-l-1 text-sm leading-5 hover:text-hi">
          <a href="/projects/camkes/">Overview</a>
        </li>
        <li class="text-light bordercol pb-1 pl-3 border-l-1 text-sm leading-5 hover:text-hi">
          <a href="/projects/camkes/setting-up.html">Setting up your machine</a>
        </li>
      <li class="pl-3 pb-1 border-l-1 bordercol">
        <div class="text-sm font-bold menu-title text-light hover:text-hi">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true" data-slot="icon" class="menu-chevron h-4 w-4 mb-0.5 -ml-2 -mr-0.5 inline cursor-pointer ">
  <path fill-rule="evenodd" d="M5.22 8.22a.75.75 0 0 1 1.06 0L10 11.94l3.72-3.72a.75.75 0 1 1 1.06 1.06l-4.25 4.25a.75.75 0 0 1-1.06 0L5.22 9.28a.75.75 0 0 1 0-1.06Z" clip-rule="evenodd"/>
</svg>
          <span class="cursor-pointer">Tutorials</span>
        </div>
        <ul class="menu-content ml-3 on">
            <li class="text-light bordercol pl-3 border-l-1 text-sm leading-5 hover:text-hi">
              <a href="/Tutorials/hello-camkes-0.html">Hello CAmkES</a>
            </li>
            <li class="text-light bordercol pl-3 border-l-1 text-sm leading-5 hover:text-hi">
              <a href="/Tutorials/hello-camkes-1.html">Introduction</a>
            </li>
            <li class="text-light bordercol pl-3 border-l-1 text-sm leading-5 hover:text-hi">
              <a href="/Tutorials/hello-camkes-2.html">Events</a>
            </li>
            <li class="text-light bordercol pl-3 border-l-1 text-sm leading-5 hover:text-hi">
              <a href="/Tutorials/hello-camkes-timer.html">Timer</a>
            </li>
            <li class="text-hi border-f_green-500 pl-3 border-l-1 text-sm leading-5 hover:text-hi">
              <a href="/Tutorials/camkes-vm-linux.html">Virtual Machines</a>
            </li>
            <li class="text-light bordercol pl-3 border-l-1 text-sm leading-5 hover:text-hi">
              <a href="/Tutorials/camkes-vm-crossvm.html">Cross-VM connectors</a>
            </li>
        </ul>
      </li>
        <li class="text-light bordercol pb-1 pl-3 border-l-1 text-sm leading-5 hover:text-hi">
          <a href="/Tutorials/how-to-CAmkES.html">How-to</a>
        </li>
        <li class="text-light bordercol pb-1 pl-3 border-l-1 text-sm leading-5 hover:text-hi">
          <a href="/projects/camkes/manual.html">Manual</a>
        </li>
        <li class="text-light bordercol pb-1 pl-3 border-l-1 text-sm leading-5 hover:text-hi">
          <a href="/projects/camkes/hardware.html">Supported platforms</a>
        </li>
      <li class="pl-3 pb-1 border-l-1 bordercol">
        <div class="text-sm  menu-title text-light hover:text-hi">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true" data-slot="icon" class="menu-chevron h-4 w-4 mb-0.5 -ml-2 -mr-0.5 inline cursor-pointer rotate-270">
  <path fill-rule="evenodd" d="M5.22 8.22a.75.75 0 0 1 1.06 0L10 11.94l3.72-3.72a.75.75 0 1 1 1.06 1.06l-4.25 4.25a.75.75 0 0 1-1.06 0L5.22 9.28a.75.75 0 0 1 0-1.06Z" clip-rule="evenodd"/>
</svg>
          <span class="cursor-pointer">Virtualisation</span>
        </div>
        <ul class="menu-content ml-3 ">
            <li class="text-light bordercol pl-3 border-l-1 text-sm leading-5 hover:text-hi">
              <a href="/projects/camkes-vm/">CAmkES VM</a>
            </li>
            <li class="text-light bordercol pl-3 border-l-1 text-sm leading-5 hover:text-hi">
              <a href="/projects/virtualization/docs/libsel4vm.html">VM library</a>
            </li>
            <li class="text-light bordercol pl-3 border-l-1 text-sm leading-5 hover:text-hi">
              <a href="/projects/virtualization/docs/libsel4vmm.html">VMM library</a>
            </li>
        </ul>
      </li>
        <li class="text-light bordercol pb-1 pl-3 border-l-1 text-sm leading-5 hover:text-hi">
          <a href="/releases/camkes.html">Releases</a>
        </li>
        <li class="text-light bordercol pb-1 pl-3 border-l-1 text-sm leading-5 hover:text-hi">
          <a href="https://github.com/seL4/camkes-tool/">Sources</a>
        </li>
    </ul>
  </li>
<li class="-mt-2">&nbsp;</li>
  <li class="mt-1">
    <div class=" mb-1 menu-title hover:text-hi leading-none">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true" data-slot="icon" class="menu-chevron p-0 h-4 w-4 mb-px -mr-0.5 inline cursor-pointer rotate-270">
  <path fill-rule="evenodd" d="M5.22 8.22a.75.75 0 0 1 1.06 0L10 11.94l3.72-3.72a.75.75 0 1 1 1.06 1.06l-4.25 4.25a.75.75 0 0 1-1.06 0L5.22 9.28a.75.75 0 0 1 0-1.06Z" clip-rule="evenodd"/>
</svg>
      <span class="cursor-pointer text-sm">C support</span>
    </div>
    <ul class="menu-content ml-6 ">
        <li class="text-light bordercol pb-1 pl-3 border-l-1 text-sm leading-5 hover:text-hi">
          <a href="/projects/sel4runtime/">C runtime</a>
        </li>
        <li class="text-light bordercol pb-1 pl-3 border-l-1 text-sm leading-5 hover:text-hi">
          <a href="/projects/user_libs/">User-level libraries</a>
        </li>
        <li class="text-light bordercol pb-1 pl-3 border-l-1 text-sm leading-5 hover:text-hi">
          <a href="/projects/buildsystem/">Build System</a>
        </li>
      <li class="pl-3 pb-1 border-l-1 bordercol">
        <div class="text-sm  menu-title text-light hover:text-hi">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true" data-slot="icon" class="menu-chevron h-4 w-4 mb-0.5 -ml-2 -mr-0.5 inline cursor-pointer rotate-270">
  <path fill-rule="evenodd" d="M5.22 8.22a.75.75 0 0 1 1.06 0L10 11.94l3.72-3.72a.75.75 0 1 1 1.06 1.06l-4.25 4.25a.75.75 0 0 1-1.06 0L5.22 9.28a.75.75 0 0 1 0-1.06Z" clip-rule="evenodd"/>
</svg>
          <span class="cursor-pointer">Tutorials</span>
        </div>
        <ul class="menu-content ml-3 ">
            <li class="text-light bordercol pl-3 border-l-1 text-sm leading-5 hover:text-hi">
              <a href="/Tutorials/libraries-1.html">Init & Threads</a>
            </li>
            <li class="text-light bordercol pl-3 border-l-1 text-sm leading-5 hover:text-hi">
              <a href="/Tutorials/libraries-2.html">IPC</a>
            </li>
            <li class="text-light bordercol pl-3 border-l-1 text-sm leading-5 hover:text-hi">
              <a href="/Tutorials/libraries-3.html">ELF loading & Processes</a>
            </li>
            <li class="text-light bordercol pl-3 border-l-1 text-sm leading-5 hover:text-hi">
              <a href="/Tutorials/libraries-4.html">Timer</a>
            </li>
        </ul>
      </li>
        <li class="text-light bordercol pb-1 pl-3 border-l-1 text-sm leading-5 hover:text-hi">
          <a href="/Tutorials/how-to-libs.html">How-to</a>
        </li>
    </ul>
  </li>
  <li class="mt-1">
    <div class=" mb-1 menu-title hover:text-hi leading-none">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true" data-slot="icon" class="menu-chevron p-0 h-4 w-4 mb-px -mr-0.5 inline cursor-pointer rotate-270">
  <path fill-rule="evenodd" d="M5.22 8.22a.75.75 0 0 1 1.06 0L10 11.94l3.72-3.72a.75.75 0 1 1 1.06 1.06l-4.25 4.25a.75.75 0 0 1-1.06 0L5.22 9.28a.75.75 0 0 1 0-1.06Z" clip-rule="evenodd"/>
</svg>
      <span class="cursor-pointer text-sm">Rust support</span>
    </div>
    <ul class="menu-content ml-6 ">
        <li class="text-light bordercol pb-1 pl-3 border-l-1 text-sm leading-5 hover:text-hi">
          <a href="/projects/rust/">Overview</a>
        </li>
        <li class="text-light bordercol pb-1 pl-3 border-l-1 text-sm leading-5 hover:text-hi">
          <a href="/projects/rust/how-to-use.html">How to use</a>
        </li>
        <li class="text-light bordercol pb-1 pl-3 border-l-1 text-sm leading-5 hover:text-hi">
          <a href="/projects/rust/tutorial/introduction.html">Tutorial</a>
        </li>
        <li class="text-light bordercol pb-1 pl-3 border-l-1 text-sm leading-5 hover:text-hi">
          <a href="https://sel4.github.io/rust-sel4/">API</a>
        </li>
        <li class="text-light bordercol pb-1 pl-3 border-l-1 text-sm leading-5 hover:text-hi">
          <a href="/projects/rust/supported-configurations.html">Supported configurations</a>
        </li>
        <li class="text-light bordercol pb-1 pl-3 border-l-1 text-sm leading-5 hover:text-hi">
          <a href="/projects/rust/releases.html">Releases</a>
        </li>
        <li class="text-light bordercol pb-1 pl-3 border-l-1 text-sm leading-5 hover:text-hi">
          <a href="https://github.com/seL4/rust-sel4">Sources</a>
        </li>
    </ul>
  </li>
<li class="-mt-2">&nbsp;</li>
  <li class="mt-1">
    <div class=" mb-1 menu-title hover:text-hi leading-none">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true" data-slot="icon" class="menu-chevron p-0 h-4 w-4 mb-px -mr-0.5 inline cursor-pointer rotate-270">
  <path fill-rule="evenodd" d="M5.22 8.22a.75.75 0 0 1 1.06 0L10 11.94l3.72-3.72a.75.75 0 1 1 1.06 1.06l-4.25 4.25a.75.75 0 0 1-1.06 0L5.22 9.28a.75.75 0 0 1 0-1.06Z" clip-rule="evenodd"/>
</svg>
      <span class="cursor-pointer text-sm">ELF loader</span>
    </div>
    <ul class="menu-content ml-6 ">
        <li class="text-light bordercol pb-1 pl-3 border-l-1 text-sm leading-5 hover:text-hi">
          <a href="/projects/elfloader/">ELF loader for C</a>
        </li>
    </ul>
  </li>
  <li class="mt-1">
    <div class=" mb-1 menu-title hover:text-hi leading-none">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true" data-slot="icon" class="menu-chevron p-0 h-4 w-4 mb-px -mr-0.5 inline cursor-pointer rotate-270">
  <path fill-rule="evenodd" d="M5.22 8.22a.75.75 0 0 1 1.06 0L10 11.94l3.72-3.72a.75.75 0 1 1 1.06 1.06l-4.25 4.25a.75.75 0 0 1-1.06 0L5.22 9.28a.75.75 0 0 1 0-1.06Z" clip-rule="evenodd"/>
</svg>
      <span class="cursor-pointer text-sm">capDL</span>
    </div>
    <ul class="menu-content ml-6 ">
        <li class="text-light bordercol pb-1 pl-3 border-l-1 text-sm leading-5 hover:text-hi">
          <a href="/projects/capdl/">Overview</a>
        </li>
        <li class="text-light bordercol pb-1 pl-3 border-l-1 text-sm leading-5 hover:text-hi">
          <a href="/projects/capdl/lang-spec.html">Language Spec</a>
        </li>
        <li class="text-light bordercol pb-1 pl-3 border-l-1 text-sm leading-5 hover:text-hi">
          <a href="/projects/capdl/c-loader-app.html">capDL loader (C)</a>
        </li>
        <li class="text-light bordercol pb-1 pl-3 border-l-1 text-sm leading-5 hover:text-hi">
          <a href="/releases/capDL.html">Releases</a>
        </li>
    </ul>
  </li>
<li class="-mt-2">&nbsp;</li>
  <li class="mt-1">
    <div class=" mb-1 menu-title hover:text-hi leading-none">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true" data-slot="icon" class="menu-chevron p-0 h-4 w-4 mb-px -mr-0.5 inline cursor-pointer rotate-270">
  <path fill-rule="evenodd" d="M5.22 8.22a.75.75 0 0 1 1.06 0L10 11.94l3.72-3.72a.75.75 0 1 1 1.06 1.06l-4.25 4.25a.75.75 0 0 1-1.06 0L5.22 9.28a.75.75 0 0 1 0-1.06Z" clip-rule="evenodd"/>
</svg>
      <span class="cursor-pointer text-sm">Examples &amp; demos</span>
    </div>
    <ul class="menu-content ml-6 ">
        <li class="text-light bordercol pb-1 pl-3 border-l-1 text-sm leading-5 hover:text-hi">
          <a href="/examples.html">Overview</a>
        </li>
    </ul>
  </li>
</ul>

      </div>
      <div id="sidebar-handle"
           class="flex-none relative cursor-col-resize min-h-full
                  bg-gray-200 dark:bg-gray-700 w-px">
      </div>
    </div>
    <div class="flex-1">
      
<div class="w-full pb-px bg-gray-200 dark:bg-gray-700">
  <header class="h-[2rem] sm:h-[2.5rem] lg:h-[3.5rem] w-full flex flex-row items-center gap-2 md:gap-4 md:py-2 std-bg">
    <div id="burger">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="text-dark ml-3 mr-0 sm:mr-3 lg:mx-4 w-4 h-4 lg:w-6 lg:h-6 cursor-pointer">
  <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5"/>
</svg>
    </div>
    <div class="flex-1"></div>
    <a href="/releases.html"
      class="text-lighter hover:text-light hover:underline text-tiny sm:text-xs lg:text-sm font-semibold">
      Releases
    </a>
    <a href="https://sel4.systems/Contribute/"
      class="text-lighter hover:text-light hover:underline text-tiny sm:text-xs lg:text-sm font-semibold">
      Contribute
    </a>
    <a href="https://sel4.systems/contact.html"
      class="text-lighter hover:text-light hover:underline text-tiny sm:text-xs lg:text-sm font-semibold">
      Contact
    </a>
    <a href="https://sel4.systems/support.html"
      class="text-lighter hover:text-light hover:underline text-tiny sm:text-xs lg:text-sm font-semibold">
      Support
    </a>
    <!-- main site button -->
    <a href="https://sel4.systems"
      class="flex-none button-outline ml-0 text-tiny px-2 py-0.5 sm:px-3 sm:py-1 h-4 sm:h-6 md:py-2 md:h-8 lg:h-9 md:text-xs lg:text-sm mr-0 md:mr-4">Main Site
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" aria-hidden="true" viewBox="0 0 24 24" stroke="currentColor" data-slot="icon" class="hidden sm:inline-icon">
<path stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" d="M13.5 6H5.25A2.25 2.25 0 0 0 3 8.25v10.5A2.25 2.25 0 0 0 5.25 21h10.5A2.25 2.25 0 0 0 18 18.75V10.5m-10.5 6L21 3m0 0h-5.25M21 3v5.25"/>
</svg>
    </a>
    <!-- github button -->
    <a href="https://github.com/seL4"
      class="mr-2 lg:mr-6 px-0 sm:px-3 pt-2 sm:pt-1 pb-2 block text-gray-400 dark:text-gray-500 hover:text-gray-500 dark:hover:text-gray-300">
      <span class="sr-only">seL4 on GitHub</span>
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor" aria-hidden="true" data-slot="icon" class="w-4 h-4 sm:w-5 sm:h-5 lg:w-6 lg:h-6">
<path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"/>
</svg>
    </a>
  </header>
</div>

      <div class="grid grid-cols-1 xl:grid-cols-[4rem_auto_4rem] h-[calc(100%-3rem)]">
        <div class="hidden xl:flex relative hover:bg-gray-100 dark:hover:bg-gray-800 items-center justify-center">
          <a href="hello-camkes-timer.html" class="mx-auto my-auto text-lighter">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="h-7 w-7 stroke-3">
  <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 19.5 8.25 12l7.5-7.5"/>
</svg>
            <span class="absolute inset-0"></span>
          </a>
          </div>
        <div class="flex flex-col max-w-full overflow-y-auto">
          <div id="main-div" class="flex-1 max-w-full">
            <main class="mx-6 md:mx-10 xl:mx-12 my-12
                        overflow-x-auto" id="page-top">

              <div class="theprose mx-auto ext-links">
  
<!--
  Copyright 2017, Data61, CSIRO (ABN 41 687 119 230)

  SPDX-License-Identifier: BSD-2-Clause
-->

<h1 id="camkes-vm-linux">CAmkES VM Linux</h1>

<p>This tutorial provides an introduction to creating VM guests and applications on seL4 using CAmkES.</p>

<p>You will become familiar with:</p>

<ul>
  <li>Creating, configuring and building guest Linux VM components in CAmkES.</li>
  <li>Building and installing your own Linux VM user-level programs and kernel modules.</li>
</ul>

<p><em>Note that the instructions for this tutorial are only for Linux.</em></p>

<h2 id="prerequisites">Prerequisites</h2>
<ol>
  <li><a href="/Tutorials/setting-up.html">Set up your machine</a></li>
  <li><a href="/Tutorials/hello-camkes-timer.html">CAmkES timer tutorial</a></li>
</ol>

<h2 id="capdl-loader">capDL Loader</h2>

<p>This tutorial uses the <em>capDL loader</em>, a root task which allocates statically
 configured objects and capabilities.</p>

<details>
  <summary>Get capDL</summary>
  <p>The capDL loader parses
a static description of the system and the relevant ELF binaries.
It is primarily used in <a href="/projects/camkes/">CAmkES</a> projects
but we also use it in the tutorials to reduce redundant code.
The program that you construct will end up with its own CSpace and VSpace, which are separate
from the root task, meaning CSlots like <code class="language-plaintext highlighter-rouge">seL4_CapInitThreadVSpace</code> have no meaning
in applications loaded by the capDL loader.</p>

  <p>More information about capDL projects can be found <a href="/projects/capdl/">here</a>.</p>

  <p>For this tutorial clone the <a href="https://github.com/sel4/capdl">capDL repo</a>. This can be added in a directory that is adjacent to the main <code class="language-plaintext highlighter-rouge">tutorials</code> directory.</p>
</details>

<h2 id="initialising">Initialising</h2>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># For instructions about obtaining the tutorial sources see /Tutorials/get-the-tutorials</span>
<span class="c">#</span>
<span class="c"># Follow these instructions to initialise the tutorial</span>
<span class="c"># initialising the build directory with a tutorial exercise</span>
./init <span class="nt">--tut</span> camkes-vm-linux
<span class="c"># building the tutorial exercise</span>
<span class="nb">cd </span>camkes-vm-linux_build
ninja
</code></pre></div></div>

<details>
  <summary><em>Hint:</em> tutorial solutions</summary>

  <p>All tutorials come with complete solutions. To get solutions run:</p>

  <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># For instructions about obtaining the tutorial sources see /Tutorials/get-the-tutorials</span>
<span class="c">#</span>
<span class="c"># Follow these instructions to initialise the tutorial</span>
<span class="c"># initialising the build directory with a tutorial exercise</span>
./init <span class="nt">--solution</span> <span class="nt">--tut</span> camkes-vm-linux
<span class="c"># building the tutorial exercise</span>
<span class="nb">cd </span>camkes-vm-linux_build
ninja
</code></pre></div>  </div>

</details>

<h2 id="background">Background</h2>

<p>This tutorial is set up with a basic CAmkES VM configuration for you to build upon.
The starting application should boot a single, very basic Linux guest.</p>

<p>To build the tutorial, run:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># In build directory</span>
ninja
</code></pre></div></div>

<p>You can boot the tutorial on an x86 hardware platform with a multiboot boot loader,
or use the <a href="https://www.qemu.org">QEMU</a> simulator. <strong>Note if you are using QEMU
it is important to ensure that your host machine has VT-x support and <a href="https://www.linux-kvm.org/page/Main_Page">KVM</a>
installed. You also need to ensure you have enabled nested virtulisation with KVM guests as described
<a href="https://www.linux-kvm.org/page/Nested_Guests">here</a>.</strong></p>

<p>To simulate the image you can run the provided simulation script with some additional parameters:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># In the build directory</span>
<span class="c"># You will need to set up a tap device first:</span>
<span class="c"># ip tuntap add tap0 mode tap</span>
<span class="c"># ip addr add 10.0.120.100/24 dev tap0</span>
<span class="c"># ip link set dev tap0 up</span>
<span class="nb">sudo</span> ./simulate <span class="nt">--machine</span> q35,accel<span class="o">=</span>kvm,kernel-irqchip<span class="o">=</span><span class="nb">split</span> <span class="nt">--mem-size</span> 2G <span class="nt">--extra-cpu-opts</span> <span class="s2">"+vmx"</span> <span class="nt">--extra-qemu-args</span><span class="o">=</span><span class="s2">"-enable-kvm -device intel-iommu,intremap=off -net nic,model=e1000 -net tap,script=no,ifname=tap0"</span>
</code></pre></div></div>

<p>When first simulating the image you should see the following login prompt:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Welcome to Buildroot
buildroot login:
</code></pre></div></div>

<p>You can login with the username <code class="language-plaintext highlighter-rouge">root</code> and the password <code class="language-plaintext highlighter-rouge">root</code>.</p>

<p>The Linux guest was built using <a href="https://buildroot.org/">buildroot</a>, which
creates a compatible kernel and minimal root filesystem containing busybox and a in-memory file system (a ramdisk).</p>

<h2 id="vm-components">VM Components</h2>

<p>Each VM component has its own assembly implementation, where the guest environment is configured.
The provided VM configuration is defined in <code class="language-plaintext highlighter-rouge">vm_tutorial.camkes</code>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>import &lt;VM/vm.camkes&gt;;

#include &lt;configurations/vm.h&gt;

#define VM_GUEST_CMDLINE "earlyprintk=ttyS0,115200 console=ttyS0,115200 i8042.nokbd=y i8042.nomux=y \
i8042.noaux=y io_delay=udelay noisapnp pci=nomsi debug root=/dev/mem"

component Init0 {
    VM_INIT_DEF()
}

assembly {
    composition {
        VM_COMPOSITION_DEF()
        VM_PER_VM_COMP_DEF(0)
    }

    configuration {
        VM_CONFIGURATION_DEF()
        VM_PER_VM_CONFIG_DEF(0)

        vm0.simple_untyped23_pool = 20;
        vm0.heap_size = 0x2000000;
        vm0.guest_ram_mb = 128;
        vm0.kernel_cmdline = VM_GUEST_CMDLINE;
        vm0.kernel_image = "bzimage";
        vm0.kernel_relocs = "bzimage";
        vm0.initrd_image = "rootfs.cpio";
        vm0.iospace_domain = 0x0f;
    }
}
</code></pre></div></div>

<p>Most of the work here is done by five C preprocessor macros:
<code class="language-plaintext highlighter-rouge">VM_INIT_DEF</code>, <code class="language-plaintext highlighter-rouge">VM_COMPOSITION_DEF</code>, <code class="language-plaintext highlighter-rouge">VM_PER_VM_COMP_DEF</code>,
<code class="language-plaintext highlighter-rouge">VM_CONFIGURATION_DEF</code>, <code class="language-plaintext highlighter-rouge">VM_PER_VM_CONFIG_DEF</code>.</p>

<p>These are all defined in <code class="language-plaintext highlighter-rouge">projects/camkes/vm/components/VM/configurations/vm.h</code>,
and are concerned with specifying and configuring components that all
VM(M)s need.</p>

<p>The <code class="language-plaintext highlighter-rouge">Init0</code> component corresponds to a single guest. Because of some rules
in the cpp macros, the <em>Ith</em> guest in your system must be defined as a
component named <code class="language-plaintext highlighter-rouge">InitI</code>. <code class="language-plaintext highlighter-rouge">InitI</code> components will be instantiated in the
composition section by the <code class="language-plaintext highlighter-rouge">VM_PER_VM_COMP_DEF</code> macro with instance
names <code class="language-plaintext highlighter-rouge">vmI</code>. The <code class="language-plaintext highlighter-rouge">vm0</code> component instance being configured above is an
instance of <code class="language-plaintext highlighter-rouge">Init0</code>. The C source code for<code class="language-plaintext highlighter-rouge">InitI</code> components is in
<code class="language-plaintext highlighter-rouge">projects/camkes/vm/components/Init/src</code>. This source will be used for components
named <code class="language-plaintext highlighter-rouge">InitI</code> for <em>I</em> in <code class="language-plaintext highlighter-rouge">0..VM_NUM_VM - 1</code>.</p>

<p>The values of <code class="language-plaintext highlighter-rouge">vm0.kernel_cmdline</code>, <code class="language-plaintext highlighter-rouge">vm0.kernel_image</code> and <code class="language-plaintext highlighter-rouge">vm0.initrd_image</code> are all
strings specifying:</p>
<ul>
  <li>boot arguments to the guest Linux,</li>
  <li>the name of the guest Linux kernel image file,</li>
  <li>and the name of the guest Linux initrd file (the root filesystem to use during system initialisation).</li>
</ul>

<p>The kernel command-line is defined in the <code class="language-plaintext highlighter-rouge">VM_GUEST_CMDLINE</code> macro. The kernel image
and rootfs names are defined in the applications <code class="language-plaintext highlighter-rouge">CMakeLists.txt</code> file.
These are the names of files in a CPIO archive that gets created by the build system, and
linked into the VMM. In the simple configuration for thie tutorial, the VMM uses
the <code class="language-plaintext highlighter-rouge">bzimage</code> and <code class="language-plaintext highlighter-rouge">rootfs.cpio</code> names to find the appropriate files
in this archive.</p>

<p>To see how the <code class="language-plaintext highlighter-rouge">Init</code> component and CPIO archive are defined within the build system,
look at the app’s <code class="language-plaintext highlighter-rouge">CMakeList.txt</code>:</p>

<div class="language-cmake highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">include</span><span class="p">(</span><span class="si">${</span><span class="nv">SEL4_TUTORIALS_DIR</span><span class="si">}</span>/settings.cmake<span class="p">)</span>
<span class="nf">sel4_tutorials_regenerate_tutorial</span><span class="p">(</span><span class="si">${</span><span class="nv">CMAKE_CURRENT_SOURCE_DIR</span><span class="si">}</span><span class="p">)</span>

<span class="nb">cmake_minimum_required</span><span class="p">(</span>VERSION 3.8.2<span class="p">)</span>

<span class="nb">project</span><span class="p">(</span>vm-app C ASM<span class="p">)</span>
<span class="nb">include</span><span class="p">(</span>ExternalProject<span class="p">)</span>
<span class="nb">find_package</span><span class="p">(</span>camkes-vm REQUIRED<span class="p">)</span>
<span class="nb">include</span><span class="p">(</span><span class="si">${</span><span class="nv">CAMKES_VM_SETTINGS_PATH</span><span class="si">}</span><span class="p">)</span>
<span class="nf">camkes_x86_vm_setup_x86_vm_environment</span><span class="p">()</span>
<span class="nb">include</span><span class="p">(</span><span class="si">${</span><span class="nv">CAMKES_VM_HELPERS_PATH</span><span class="si">}</span><span class="p">)</span>
<span class="nb">find_package</span><span class="p">(</span>camkes-vm-linux REQUIRED<span class="p">)</span>
<span class="nb">include</span><span class="p">(</span><span class="si">${</span><span class="nv">CAMKES_VM_LINUX_HELPERS_PATH</span><span class="si">}</span><span class="p">)</span>


<span class="c1"># Include CAmkES VM helper functions</span>




<span class="c1"># Declare VM component: Init0</span>
<span class="nf">DeclareCAmkESVM</span><span class="p">(</span>Init0<span class="p">)</span>

<span class="c1"># Get Default Linux VM files</span>
<span class="nf">GetArchDefaultLinuxKernelFile</span><span class="p">(</span><span class="s2">"32"</span> default_kernel_file<span class="p">)</span>
<span class="nf">GetArchDefaultLinuxRootfsFile</span><span class="p">(</span><span class="s2">"32"</span> default_rootfs_file<span class="p">)</span>

<span class="c1"># Decompress Linux Kernel image and add to file server</span>
<span class="nf">DecompressLinuxKernel</span><span class="p">(</span>extract_linux_kernel decompressed_kernel <span class="si">${</span><span class="nv">default_kernel_file</span><span class="si">}</span><span class="p">)</span>

<span class="nf">AddToFileServer</span><span class="p">(</span><span class="s2">"bzimage"</span> <span class="si">${</span><span class="nv">decompressed_kernel</span><span class="si">}</span> DEPENDS extract_linux_kernel<span class="p">)</span>



<span class="c1"># Add rootfs images into file server</span>
<span class="nf">AddToFileServer</span><span class="p">(</span><span class="s2">"rootfs.cpio"</span> <span class="si">${</span><span class="nv">default_rootfs_file</span><span class="si">}</span><span class="p">)</span>



<span class="c1"># Initialise CAmkES Root Server with addition CPP includes</span>
<span class="nf">DeclareCAmkESVMRootServer</span><span class="p">(</span>vm_tutorial.camkes<span class="p">)</span>
<span class="nf">GenerateCAmkESRootserver</span><span class="p">()</span>

</code></pre></div></div>

<p>The file <code class="language-plaintext highlighter-rouge">projects/camkes/vm/camkes_vm_helpers.cmake</code> provides helper functions for the VM projects,
including  <code class="language-plaintext highlighter-rouge">DeclareCAmkESVM(Init0)</code>, which is used to define the <code class="language-plaintext highlighter-rouge">Init0</code> VM component.
Each Init component requires a corresponding <code class="language-plaintext highlighter-rouge">DeclareCAmkESVM</code> function.</p>

<p><code class="language-plaintext highlighter-rouge">GetArchDefaultLinuxKernelFile</code> (defined in <code class="language-plaintext highlighter-rouge">projects/camkes/vm-linux/vm-linux-helpers.cmake</code>)
is a helper function that retrieves the location of an architectural specific VM image provided
in the <code class="language-plaintext highlighter-rouge">projects/vm-linux</code> folder, which contains some tools for building new linux kernel
and root filesystem images, as well as the images that these tools
produce. A fresh checkout of this project will contain some pre-built
images (<code class="language-plaintext highlighter-rouge">bzimage</code> and <code class="language-plaintext highlighter-rouge">rootfs.cpio</code>), to speed up build times.</p>

<p><code class="language-plaintext highlighter-rouge">DecompressLinuxKernel</code> is used to extract the vmlinux image, which <code class="language-plaintext highlighter-rouge">AddToFileServer</code> then places
in the fileserver along with the rootfs.</p>

<h2 id="adding-to-the-guest">Adding to the guest</h2>

<p>In the simple buildroot guest image, the
initrd (rootfs.cpio) is also the filesystem you get access to after
logging in. To make new programs available to the guest you need to add them to the
rootfs.cpio archive. Similarly, to make new kernel modules available to
the guest they must be added to the rootfs.cpio archive also.</p>

<p>In this tutorial you will  install new programs into the guest VM.</p>

<h3 id="vm-linux-helperscmake">vm-linux-helpers.cmake</h3>

<p>The <code class="language-plaintext highlighter-rouge">projects/camkes/vm-linux</code> directory contains CMake helpers to
overlay rootfs.cpio archives with a desired set of programs, modules
and scripts.</p>

<h4 id="addfiletooverlaydirfilename-file_location-root_location-overlay_name"><code class="language-plaintext highlighter-rouge">AddFileToOverlayDir(filename file_location root_location overlay_name)</code></h4>
<p>This helper allows you to overlay specific files onto a rootfs image. The caller specifies
the file they wish to install in the rootfs image (<code class="language-plaintext highlighter-rouge">file_location</code>), the name they want the file
to be called in the rootfs (<code class="language-plaintext highlighter-rouge">filename</code>) and the location they want the file to installed in the
rootfs (<code class="language-plaintext highlighter-rouge">root_location</code>), e.g “usr/bin”. Lastly the caller passes in a unique target name for the overlay
(<code class="language-plaintext highlighter-rouge">overlay_name</code>). You can repeatedly call this helper with different files for a given target to build
up a set of files to be installed on a rootfs image.</p>

<h4 id="addoverlaydirtorootfsrootfs_overlay-rootfs_image-rootfs_distro-rootfs_overlay_mode-output_rootfs_location-target_name"><code class="language-plaintext highlighter-rouge">AddOverlayDirToRootfs(rootfs_overlay rootfs_image rootfs_distro rootfs_overlay_mode output_rootfs_location target_name)</code></h4>
<p>This helper allows you to install a defined overlay target onto a given rootfs image. The caller specifies
the rootfs overlay target name (<code class="language-plaintext highlighter-rouge">rootfs_overlay</code>), the rootfs image they wish to install their files onto
(<code class="language-plaintext highlighter-rouge">rootfs_image</code>), the distribution of their rootfs image (<code class="language-plaintext highlighter-rouge">rootfs_distro</code>, only ‘buildroot’ and ‘debian’ is
supported) and the output location of their overlayed rootfs image (<code class="language-plaintext highlighter-rouge">output_rootfs_location</code>). Lastly the caller
specifies how the files will be installed into their rootfs image through <code class="language-plaintext highlighter-rouge">rootfs_overlay_mode</code>. These modes include:</p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">rootfs_install</code>: The files are installed onto the rootfs image. This is useful if the rootfs image is the filesystem
your guest VM is using when it boots. However this won’t be useful if your VM will be booting from disk since the installed files
won’t be present after the VM boots.</li>
  <li><code class="language-plaintext highlighter-rouge">overlay</code>: The files are mounted as an overlayed filesystem (overlayfs). This is useful if you are booting from disk and don’t wish to
install the artifacts permanently onto the VM. The downside to this is that writes to the overlayed root do not persist between boots. This
mode is benefitial for debugging purposes and live VM images.</li>
  <li><code class="language-plaintext highlighter-rouge">fs_install</code>: The files are permanently installed on the VM’s file system, after the root has been mounted.
    <h4 id="addexternalprojfilestooverlayexternal_target-external_install_dir-overlay_target-overlay_root_location"><code class="language-plaintext highlighter-rouge">AddExternalProjFilesToOverlay(external_target external_install_dir overlay_target overlay_root_location)</code></h4>
    <p>This helper allows you to add files generated from an external CMake project to an overlay target. This is mainly a wrapper around
<code class="language-plaintext highlighter-rouge">AddOverlayDirToRootfs</code> which in addition creates a target for the generated file in the external project. The caller passes the external
project target (<code class="language-plaintext highlighter-rouge">external_target</code>), the external projects install directory (<code class="language-plaintext highlighter-rouge">external_install_dir</code>), the overlay target you want to add the
file to (<code class="language-plaintext highlighter-rouge">overlay_target</code>) and the location you wish to install the file within the rootfs image (<code class="language-plaintext highlighter-rouge">overlay_root_location</code>).</p>
  </li>
</ul>

<h3 id="linux-source-helperscmake">linux-source-helpers.cmake</h3>

<h4 id="downloadlinuxlinux_major-linux_minor-linux_md5-linux_out_dir-linux_out_target"><code class="language-plaintext highlighter-rouge">DownloadLinux(linux_major linux_minor linux_md5 linux_out_dir linux_out_target)</code></h4>
<p>This is a helper function for downloading the linux source. This is needed if we wish to build our own kernel modules.</p>

<h4 id="configurelinuxlinux_dir-linux_config_location-linux_symvers_location-configure_linux_target"><code class="language-plaintext highlighter-rouge">ConfigureLinux(linux_dir linux_config_location linux_symvers_location configure_linux_target)</code></h4>
<p>This helper function is used for configuring downloaded linux source with a given Kbuild defconfig (<code class="language-plaintext highlighter-rouge">linux_config_location</code>)
and symvers file (<code class="language-plaintext highlighter-rouge">linux_symvers_location</code>).</p>

<h2 id="exercises">Exercises</h2>

<h3 id="adding-a-program">Adding a program</h3>

<p>This exercise guides you through adding a new program to the Linux guest user-level environment.</p>

<p>First, make a new directory:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">mkdir</span> <span class="nt">-p</span> pkg/hello
</code></pre></div></div>
<p>Then a simple C program in <code class="language-plaintext highlighter-rouge">pkg/hello/hello.c</code>:</p>
<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">argv</span><span class="p">[])</span> <span class="p">{</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"Hello, World!</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>
<p>Then create a build file for the program at <code class="language-plaintext highlighter-rouge">pkg/hello/CMakeLists.txt</code>:</p>

<div class="language-cmake highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cmake_minimum_required</span><span class="p">(</span>VERSION 3.8.2<span class="p">)</span>

<span class="nb">project</span><span class="p">(</span>hello C<span class="p">)</span>

<span class="nb">add_executable</span><span class="p">(</span>hello hello.c<span class="p">)</span>

<span class="nb">target_link_libraries</span><span class="p">(</span>hello -static<span class="p">)</span>
</code></pre></div></div>
<p>Now integrate the new program with the build system.
Update the VM apps <code class="language-plaintext highlighter-rouge">CMakeLists.txt</code> to declare the hello application as an
external project and add it to our overlay.
 Do this by replacing the line <code class="language-plaintext highlighter-rouge">AddToFileServer("rootfs.cpio" ${default_rootfs_file})</code> with the following:</p>

<div class="language-cmake highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Get Custom toolchain for 32 bit Linux</span>
<span class="nb">include</span><span class="p">(</span>cross_compiling<span class="p">)</span>
<span class="nf">FindCustomPollyToolchain</span><span class="p">(</span>LINUX_32BIT_TOOLCHAIN <span class="s2">"linux-gcc-32bit-pic"</span><span class="p">)</span>
<span class="c1"># Declare our hello app external project</span>
<span class="nf">ExternalProject_Add</span><span class="p">(</span>hello-app
    SOURCE_DIR <span class="si">${</span><span class="nv">CMAKE_CURRENT_SOURCE_DIR</span><span class="si">}</span>/pkg/hello
    BINARY_DIR <span class="si">${</span><span class="nv">CMAKE_CURRENT_BINARY_DIR</span><span class="si">}</span>/hello-app
    BUILD_ALWAYS ON
    STAMP_DIR <span class="si">${</span><span class="nv">CMAKE_CURRENT_BINARY_DIR</span><span class="si">}</span>/hello-app-stamp
    EXCLUDE_FROM_ALL
    INSTALL_COMMAND <span class="s2">""</span>
    CMAKE_ARGS
        -DCMAKE_BUILD_TYPE=<span class="si">${</span><span class="nv">CMAKE_BUILD_TYPE</span><span class="si">}</span>
        -DCMAKE_TOOLCHAIN_FILE=<span class="si">${</span><span class="nv">LINUX_32BIT_TOOLCHAIN</span><span class="si">}</span>
<span class="p">)</span>
<span class="c1"># Add the hello world app to our overlay ('vm-overlay')</span>
<span class="nf">AddExternalProjFilesToOverlay</span><span class="p">(</span>hello-app <span class="si">${</span><span class="nv">CMAKE_CURRENT_BINARY_DIR</span><span class="si">}</span>/hello-app vm-overlay <span class="s2">"usr/sbin"</span>
    FILES hello<span class="p">)</span>
<span class="c1"># Add the overlay directory to our default rootfs image</span>
<span class="nf">AddOverlayDirToRootfs</span><span class="p">(</span>vm-overlay <span class="si">${</span><span class="nv">default_rootfs_file</span><span class="si">}</span> <span class="s2">"buildroot"</span> <span class="s2">"rootfs_install"</span>
    rootfs_file rootfs_target<span class="p">)</span>
<span class="nf">AddToFileServer</span><span class="p">(</span><span class="s2">"rootfs.cpio"</span> <span class="si">${</span><span class="nv">rootfs_file</span><span class="si">}</span> DEPENDS rootfs_target<span class="p">)</span>
</code></pre></div></div>
<p>Now rebuild the project…</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># In build directory</span>
ninja
</code></pre></div></div>
<p>..and run it (use <code class="language-plaintext highlighter-rouge">root</code> as username and password).
You should be able to use the new program.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Welcome to Buildroot
buildroot login: root
Password:
# hello
Hello, World!
</code></pre></div></div>

<h2 id="adding-a-kernel-module">Adding a kernel module</h2>

<p>The next exercise guides you through the addition of a new kernel module that provides
guest to VMM communication. This is a very simply module: you’ll create a special file
associated with the new module, which when written to causes the VMM to print message.</p>

<p>First, make a new directory:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mkdir -p modules/poke
</code></pre></div></div>
<p>Then create the following file for the module in <code class="language-plaintext highlighter-rouge">modules/poke/poke.c</code>.</p>
<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include</span> <span class="cpf">&lt;linux/module.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;linux/kernel.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;linux/init.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;linux/fs.h&gt;</span><span class="cp">
</span>
<span class="cp">#include</span> <span class="cpf">&lt;asm/uaccess.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;asm/kvm_para.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;asm/io.h&gt;</span><span class="cp">
</span>
<span class="cp">#define DEVICE_NAME "poke"
</span>
<span class="k">static</span> <span class="kt">int</span> <span class="n">major_number</span><span class="p">;</span>

<span class="k">static</span> <span class="kt">ssize_t</span> <span class="nf">poke_write</span><span class="p">(</span><span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">f</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="n">__user</span><span class="o">*</span><span class="n">b</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">s</span><span class="p">,</span> <span class="n">loff_t</span> <span class="o">*</span><span class="n">o</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">printk</span><span class="p">(</span><span class="s">"hi</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span> <span class="c1">// TODO replace with hypercall</span>
    <span class="k">return</span> <span class="n">s</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">struct</span> <span class="n">file_operations</span> <span class="n">fops</span> <span class="o">=</span> <span class="p">{</span>
    <span class="p">.</span><span class="n">write</span> <span class="o">=</span> <span class="n">poke_write</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="n">__init</span> <span class="nf">poke_init</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">major_number</span> <span class="o">=</span> <span class="n">register_chrdev</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">DEVICE_NAME</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">fops</span><span class="p">);</span>
    <span class="n">printk</span><span class="p">(</span><span class="n">KERN_INFO</span> <span class="s">"%s initialized with major number %dn"</span><span class="p">,</span> <span class="n">DEVICE_NAME</span><span class="p">,</span> <span class="n">major_number</span><span class="p">);</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="n">__exit</span> <span class="nf">poke_exit</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">unregister_chrdev</span><span class="p">(</span><span class="n">major_number</span><span class="p">,</span> <span class="n">DEVICE_NAME</span><span class="p">);</span>
    <span class="n">printk</span><span class="p">(</span><span class="n">KERN_INFO</span><span class="s">"%s exitn"</span><span class="p">,</span> <span class="n">DEVICE_NAME</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">module_init</span><span class="p">(</span><span class="n">poke_init</span><span class="p">);</span>
<span class="n">module_exit</span><span class="p">(</span><span class="n">poke_exit</span><span class="p">);</span>
</code></pre></div></div>
<p>Now add a Makefile for building the module in <code class="language-plaintext highlighter-rouge">modules/poke/Makefile</code>:</p>

<div class="language-make highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">obj-m</span> <span class="o">+=</span> poke.o

<span class="nl">all</span><span class="o">:</span>
	make <span class="nt">-C</span> <span class="p">$(</span>KHEAD<span class="p">)</span> <span class="nv">M</span><span class="o">=</span><span class="p">$(</span>PWD<span class="p">)</span> modules

<span class="nl">clean</span><span class="o">:</span>
	make <span class="nt">-C</span> <span class="p">$(</span>KHEAD<span class="p">)</span> <span class="nv">M</span><span class="o">=</span><span class="p">$(</span>PWD<span class="p">)</span> clean
</code></pre></div></div>

<p>Create a <code class="language-plaintext highlighter-rouge">modules/CMakeLists.txt</code> to define the new Linux module with the following content:</p>
<div class="language-cmake highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cmake_minimum_required</span><span class="p">(</span>VERSION 3.8.2<span class="p">)</span>

<span class="nb">if</span><span class="p">(</span>NOT MODULE_HELPERS_FILE<span class="p">)</span>
    <span class="nb">message</span><span class="p">(</span>FATAL_ERROR <span class="s2">"MODULE_HELPERS_FILE is not defined"</span><span class="p">)</span>
<span class="nb">endif</span><span class="p">()</span>

<span class="nb">include</span><span class="p">(</span><span class="s2">"</span><span class="si">${</span><span class="nv">MODULE_HELPERS_FILE</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

<span class="nf">DefineLinuxModule</span><span class="p">(</span><span class="si">${</span><span class="nv">CMAKE_CURRENT_LIST_DIR</span><span class="si">}</span>/poke poke-module poke-target KERNEL_DIR <span class="si">${</span><span class="nv">LINUX_KERNEL_DIR</span><span class="si">}</span><span class="p">)</span>
</code></pre></div></div>
<p>Update the VM <code class="language-plaintext highlighter-rouge">CMakeLists.txt</code> file to declare the new poke module as an
external project and add it to the overlay.</p>

<p>At the top of the file include our linux helpers, add the following:</p>

<div class="language-cmake highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">include</span><span class="p">(</span><span class="si">${</span><span class="nv">CAMKES_VM_LINUX_SOURCE_HELPERS_PATH</span><span class="si">}</span><span class="p">)</span>
</code></pre></div></div>
<p>Below the includes (before <code class="language-plaintext highlighter-rouge">AddOverlayDirToRootfs</code> that was added in the first exercise <strong>Adding a program</strong>) add:</p>
<div class="language-cmake highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Setup Linux Sources</span>
<span class="nf">GetDefaultLinuxMajor</span><span class="p">(</span>linux_major<span class="p">)</span>
<span class="nf">GetDefaultLinuxMinor</span><span class="p">(</span>linux_minor<span class="p">)</span>
<span class="nf">GetDefaultLinuxMd5</span><span class="p">(</span>linux_md5<span class="p">)</span>
<span class="c1"># Download and Configure our Linux sources</span>
<span class="nf">DownloadLinux</span><span class="p">(</span><span class="si">${</span><span class="nv">linux_major</span><span class="si">}</span> <span class="si">${</span><span class="nv">linux_minor</span><span class="si">}</span> <span class="si">${</span><span class="nv">linux_md5</span><span class="si">}</span> vm_linux_extract_dir download_vm_linux<span class="p">)</span>
<span class="nb">set</span><span class="p">(</span>linux_config <span class="s2">"</span><span class="si">${</span><span class="nv">CAMKES_VM_LINUX_DIR</span><span class="si">}</span><span class="s2">/linux_configs/</span><span class="si">${</span><span class="nv">linux_major</span><span class="si">}</span><span class="s2">.</span><span class="si">${</span><span class="nv">linux_minor</span><span class="si">}</span><span class="s2">/32/config.backup-singlecore"</span><span class="p">)</span>
<span class="nb">set</span><span class="p">(</span>linux_symvers <span class="s2">"</span><span class="si">${</span><span class="nv">CAMKES_VM_LINUX_DIR</span><span class="si">}</span><span class="s2">/linux_configs/</span><span class="si">${</span><span class="nv">linux_major</span><span class="si">}</span><span class="s2">.</span><span class="si">${</span><span class="nv">linux_minor</span><span class="si">}</span><span class="s2">/32/Module.symvers"</span><span class="p">)</span>
<span class="nf">ConfigureLinux</span><span class="p">(</span><span class="si">${</span><span class="nv">vm_linux_extract_dir</span><span class="si">}</span> <span class="si">${</span><span class="nv">linux_config</span><span class="si">}</span> <span class="si">${</span><span class="nv">linux_symvers</span><span class="si">}</span> configure_vm_linux
    DEPENDS download_vm_linux
<span class="p">)</span>
<span class="c1"># Add the external poke module project</span>
<span class="nf">ExternalProject_Add</span><span class="p">(</span>poke-module
    SOURCE_DIR <span class="si">${</span><span class="nv">CMAKE_CURRENT_SOURCE_DIR</span><span class="si">}</span>/modules
    BINARY_DIR <span class="si">${</span><span class="nv">CMAKE_CURRENT_BINARY_DIR</span><span class="si">}</span>/poke-module
    BUILD_ALWAYS ON
    STAMP_DIR <span class="si">${</span><span class="nv">CMAKE_CURRENT_BINARY_DIR</span><span class="si">}</span>/poke-module-stamp
    EXCLUDE_FROM_ALL
    INSTALL_COMMAND <span class="s2">""</span>
    DEPENDS download_vm_linux configure_vm_linux
    CMAKE_ARGS
        -DCMAKE_BUILD_TYPE=<span class="si">${</span><span class="nv">CMAKE_BUILD_TYPE</span><span class="si">}</span>
        -DCMAKE_TOOLCHAIN_FILE=<span class="si">${</span><span class="nv">LINUX_32BIT_TOOLCHAIN</span><span class="si">}</span>
        -DLINUX_KERNEL_DIR=<span class="si">${</span><span class="nv">vm_linux_extract_dir</span><span class="si">}</span>
        -DMODULE_HELPERS_FILE=<span class="si">${</span><span class="nv">CAMKES_VM_LINUX_DIR</span><span class="si">}</span>/linux-module-helpers.cmake
<span class="p">)</span>
<span class="c1"># Add our module binary to the overlay</span>
<span class="nf">AddExternalProjFilesToOverlay</span><span class="p">(</span>poke-module <span class="si">${</span><span class="nv">CMAKE_CURRENT_BINARY_DIR</span><span class="si">}</span>/poke-module vm-overlay <span class="s2">"lib/modules/4.8.16/kernel/drivers/vmm"</span>
    FILES poke.ko<span class="p">)</span>
</code></pre></div></div>

<p>Write a custom init script that loads the new module during initialization.
Create a file called <code class="language-plaintext highlighter-rouge">init</code> in our tutorial directory with the following:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/sh</span>
<span class="c"># devtmpfs does not get automounted for initramfs</span>
/bin/mount <span class="nt">-t</span> devtmpfs devtmpfs /dev
<span class="nb">exec </span>0&lt;/dev/console
<span class="nb">exec </span>1&gt;/dev/console
<span class="nb">exec </span>2&gt;/dev/console

insmod /lib/modules/4.8.16/kernel/drivers/vmm/poke.ko
<span class="nb">exec</span> /sbin/init <span class="nv">$*</span>
</code></pre></div></div>
<p>Now update our the VM apps <code class="language-plaintext highlighter-rouge">CMakeLists.txt</code> file to add the new init script to the
overlay. After our call to <code class="language-plaintext highlighter-rouge">AddExternalProjFilesToOverlay</code> and before <code class="language-plaintext highlighter-rouge">AddOverlayDirToRootfs</code> for the poke module add the following:</p>

<div class="language-cmake highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">AddFileToOverlayDir</span><span class="p">(</span><span class="s2">"init"</span> <span class="si">${</span><span class="nv">CMAKE_CURRENT_LIST_DIR</span><span class="si">}</span>/init <span class="s2">"."</span> vm-overlay<span class="p">)</span>
</code></pre></div></div>
<p>and give the script executable permissions:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">chmod</span> +x init
</code></pre></div></div>
<p>Rebuild the project:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># In build directory</span>
ninja
</code></pre></div></div>
<p>Run the following commands to see the module being used:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Welcome to Buildroot
buildroot login: root
Password:
# grep poke /proc/devices        # figure out the major number of our driver
246 poke
# mknod /dev/poke c 246 0        # create the special file
# echo &gt; /dev/poke               # write to the file
[ 57.389643] hi
-sh: write error: Bad address    # the shell complains, but our module is being invoked!
</code></pre></div></div>

<h3 id="creating-a-hypercall">Creating a hypercall</h3>

<p>In <code class="language-plaintext highlighter-rouge">modules/poke/poke.c</code>, replace <code class="language-plaintext highlighter-rouge">printk("hi\n");</code> with <code class="language-plaintext highlighter-rouge">kvm_hypercall1(4, 0);</code>.
The choice of 4 is because 0..3 are already used by existing hypercalls.</p>

<p>Then register a handler for this hypercall in <code class="language-plaintext highlighter-rouge">projects/camkes/vm/components/Init/src/main.c</code>:.
Add a new function at the top of the file:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">static</span> <span class="kt">int</span> <span class="nf">poke_handler</span><span class="p">(</span><span class="n">vm_vcpu_t</span> <span class="o">*</span><span class="n">vm_vcpu</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"POKE!!!</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>In the function <code class="language-plaintext highlighter-rouge">main_continued</code> register `poke_handler`:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">vm_reg_new_vmcall_handler</span><span class="p">(</span><span class="o">&amp;</span><span class="n">vm</span><span class="p">,</span> <span class="n">poke_handler</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span> <span class="c1">// &lt;--- added</span>

<span class="cm">/* Now go run the event loop */</span>
<span class="n">vm_run</span><span class="p">(</span><span class="o">&amp;</span><span class="n">vm</span><span class="p">);</span>
</code></pre></div></div>

<p>Rebuild the project and try out the hypercall + module:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># In build directory</span>
ninja
</code></pre></div></div>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Welcome to Buildroot
buildroot login: root
Password:
# mknod /dev/poke c 246 0
# echo &gt; /dev/poke
POKE!!!
</code></pre></div></div>


</div>

<script src="/assets/js/toggle-markdown.js"></script>

            </main>
          </div>
          <nav class="flex xl:hidden flex-row justify-between items-center mb-12 text-lighter">
            <a href="hello-camkes-timer.html" class="flex-none bg-gray-100 dark:bg-gray-800 rounded py-3 px-5 ml-12">
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="h-5 w-5 stroke-2 md:h-7 md:w-7 md:stroke-3">
  <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 19.5 8.25 12l7.5-7.5"/>
</svg>
            </a>
            <div class="flex-1"></div>
            <a href="camkes-vm-crossvm.html" class="flex-none bg-gray-100 dark:bg-gray-800 rounded py-3 px-5 mr-12">
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="h-5 w-5 stroke-2 md:h-7 md:w-7 md:stroke-3">
  <path stroke-linecap="round" stroke-linejoin="round" d="m8.25 4.5 7.5 7.5-7.5 7.5"/>
</svg>
            </a>
            </nav>
<footer class="flex-none flex flex-row py-6 pl-8 pr-10 border-t-1 bordercol
               text-xs lg:text-sm font-semibold text-lighter">
  <a href="/sitemap.html"
     class="flex-none hover:text-light hover:underline">Sitemap</a>
  <a href="/processes/test-status.html"
     class="mx-1 px-1 lg:mx-2 lg:px-2 bordercol border-l-2 flex-none hover:text-light hover:underline">Test status</a>
  <div class="flex-1"></div>
<a href="https://github.com/seL4/docs/edit/master/Tutorials/camkes-vm-linux.md" class="flex-none  hover:text-light hover:underline">Edit
    page on GitHub</a>
</footer>

        </div>
        <div class="hidden xl:flex relative hover:bg-gray-100 dark:hover:bg-gray-800 flex items-center justify-center">
          <a href="camkes-vm-crossvm.html" class="mx-auto my-auto text-lighter">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="h-7 w-7 stroke-3">
  <path stroke-linecap="round" stroke-linejoin="round" d="m8.25 4.5 7.5 7.5-7.5 7.5"/>
</svg>
            <span class="absolute inset-0"></span>
          </a>
          </div>
        </div>
    </div>
  </body>
</html>
