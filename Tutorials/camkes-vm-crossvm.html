<!DOCTYPE html>
<!-- Page last generated 2025-08-04 03:52:38 +0000 -->
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>CAmkES cross-VM connectors | seL4 docs</title>

    <link rel="canonical" href="https://docs.sel4.systems/Tutorials/camkes-vm-crossvm.html">
    <link href="/assets/css/sel4.css?v=1754279558" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap" rel="stylesheet">
    <link rel="icon" type="image/x-icon" href="/assets/favicon.ico">

    <script defer src="/assets/js/menu.js"></script>
    <script defer src="/assets/js/sidebar.js"></script><script defer data-domain="docs.sel4.systems"
            src="https://analytics.sel4.systems/js/script.js"></script></head>
  <body class="flex flex-row h-screen std-bg text-dark">
    <div id="sidebar" class="hidden lg:flex flex-none w-(--sidebar-width) flex-row bg-f_neutral-50 dark:bg-gray-900">
      <div class="flex-1 overflow-y-auto min-h-full">
        <a href="/">
  <svg xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg" width="84.224365mm" height="32.530689mm" viewBox="0 0 84.224367 32.530689" version="1.1" id="svg5" inkscape:version="1.3.2 (091e20e, 2023-11-25)" sodipodi:docname="sel4-docs.svg" inkscape:export-filename="C:\Users\Birgit Brecknell\Documents\seL4 Foundation\seL4 Summit 2022\sel4_summit_v02.png" inkscape:export-xdpi="96" inkscape:export-ydpi="96" class="px-4 w-50 h-20 mx-auto mt-4 mb-10">
  <sodipodi:namedview id="namedview7" pagecolor="#ffffff" bordercolor="#666666" borderopacity="1.0" inkscape:pageshadow="2" inkscape:pageopacity="0.0" inkscape:pagecheckerboard="0" inkscape:document-units="mm" showgrid="false" inkscape:zoom="1.8116734" inkscape:cx="193.19155" inkscape:cy="87.764163" inkscape:window-width="1392" inkscape:window-height="1099" inkscape:window-x="0" inkscape:window-y="25" inkscape:window-maximized="0" inkscape:current-layer="g18" fit-margin-top="0" fit-margin-left="0" fit-margin-right="0" fit-margin-bottom="0" showguides="true" inkscape:guide-bbox="true" inkscape:showpageshadow="2" inkscape:deskcolor="#d1d1d1"/>
  <defs id="defs2">
    <rect x="680.69342" y="102.26014" width="15.612235" height="115.53054" id="rect9649"/>
    <style id="style824">.cls-1,.cls-2,.cls-3{fill:#96ca4f;}.cls-2,.cls-3{stroke:#96ca4f;stroke-miterlimit:8;}.cls-3{stroke-width:0.25px;}</style>
    <clipPath clipPathUnits="userSpaceOnUse" id="clipPath15">
      <g inkscape:label="Clip" id="use15">
        <path d="m 39.66384,47.73588 h 1.324364 q 0.447983,0 0.68299,0.06854 0.315791,0.09302 0.541007,0.330479 0.225215,0.237455 0.342719,0.582623 0.117503,0.342719 0.117503,0.847005 0,0.443087 -0.110159,0.763774 -0.13464,0.391679 -0.384335,0.63403 -0.188496,0.1836 -0.509183,0.286416 -0.239903,0.07589 -0.641374,0.07589 H 39.66384 Z m 0.724606,0.607103 v 2.377001 h 0.541006 q 0.303551,0 0.438191,-0.03427 0.176255,-0.04406 0.291311,-0.149327 0.117504,-0.105264 0.190944,-0.345168 0.07344,-0.242351 0.07344,-0.65851 0,-0.416159 -0.07344,-0.638926 -0.07344,-0.222767 -0.205632,-0.347615 -0.132192,-0.124848 -0.335375,-0.168912 -0.151776,-0.03427 -0.594862,-0.03427 z m 2.751544,1.209308 q 0,-0.54835 0.164016,-0.920445 0.122399,-0.274175 0.332927,-0.492047 0.212975,-0.217871 0.465118,-0.323135 0.335375,-0.141984 0.773566,-0.141984 0.79315,0 1.268061,0.492047 0.477358,0.492047 0.477358,1.368428 0,0.869038 -0.472462,1.361085 -0.472463,0.489598 -1.263165,0.489598 -0.800494,0 -1.272956,-0.48715 -0.472463,-0.489599 -0.472463,-1.346397 z m 0.746638,-0.02448 q 0,0.609551 0.281519,0.925342 0.281519,0.313343 0.714814,0.313343 0.433295,0 0.709918,-0.310895 0.279072,-0.313343 0.279072,-0.937582 0,-0.616894 -0.271728,-0.920445 -0.269279,-0.303551 -0.717262,-0.303551 -0.447983,0 -0.722158,0.308447 -0.274175,0.305999 -0.274175,0.925341 z m 5.596112,0.477359 0.702574,0.222767 q -0.161567,0.587519 -0.538558,0.873934 -0.374543,0.283967 -0.95227,0.283967 -0.714814,0 -1.175036,-0.48715 -0.460223,-0.489599 -0.460223,-1.336605 0,-0.895965 0.462671,-1.39046 0.46267,-0.496943 1.216652,-0.496943 0.658511,0 1.069773,0.389231 0.2448,0.230112 0.367199,0.660959 l -0.717262,0.171359 q -0.06365,-0.279071 -0.266831,-0.440639 -0.200735,-0.161567 -0.489599,-0.161567 -0.399022,0 -0.648718,0.286415 -0.247247,0.286415 -0.247247,0.927789 0,0.680542 0.244799,0.969406 0.2448,0.288863 0.636478,0.288863 0.288864,0 0.496943,-0.1836 0.20808,-0.183599 0.298655,-0.577726 z m 1.140766,0.151776 0.705022,-0.06854 q 0.06365,0.354959 0.257039,0.521422 0.19584,0.166464 0.526319,0.166464 0.350063,0 0.526318,-0.14688 0.178704,-0.149327 0.178704,-0.347615 0,-0.127295 -0.07589,-0.215423 -0.07344,-0.09058 -0.259487,-0.156672 -0.127296,-0.04406 -0.580175,-0.156671 -0.582622,-0.144432 -0.81763,-0.354959 -0.330479,-0.296208 -0.330479,-0.722158 0,-0.274176 0.154224,-0.511631 0.156671,-0.239903 0.447983,-0.364751 0.293759,-0.124848 0.70747,-0.124848 0.675646,0 1.015917,0.296208 0.342719,0.296207 0.359855,0.790701 l -0.724606,0.03182 q -0.04651,-0.276623 -0.200735,-0.396575 -0.151776,-0.122399 -0.457775,-0.122399 -0.315791,0 -0.494495,0.129743 -0.115056,0.08323 -0.115056,0.222768 0,0.127295 0.107712,0.217871 0.137088,0.115056 0.665854,0.239904 0.528767,0.124847 0.78091,0.259487 0.254591,0.132191 0.396575,0.364751 0.144432,0.230111 0.144432,0.570382 0,0.308447 -0.17136,0.577727 -0.171359,0.269279 -0.484703,0.401471 -0.313343,0.129743 -0.780909,0.129743 -0.680542,0 -1.045293,-0.313343 -0.364751,-0.315791 -0.435743,-0.917997 z" id="path16" style="font-weight:bold;font-stretch:condensed;font-size:5.01349px;font-family:Arial;-inkscape-font-specification:'Arial, Bold Condensed';fill:#96ca4f;stroke-width:0.264583" transform="scale(1.0680757,0.9362632)" aria-label="DOCS"/>
      </g>
    </clipPath>
  </defs>
  <g inkscape:label="Layer 1" inkscape:groupmode="layer" id="layer1" transform="translate(-11.065137,-18.670029)">
    <g id="g18">
      <text xml:space="preserve" transform="scale(0.26458333)" id="text9647" style="font-style:normal;font-weight:normal;font-size:40px;line-height:1.25;font-family:sans-serif;white-space:pre;shape-inside:url(#rect9649);display:inline;fill:#000000;fill-opacity:1;stroke:none"/>
      <g id="Layer_2" data-name="Layer 2" transform="matrix(0.5563179,0,0,0.5563179,-0.00218815,0)">
        <path class="cls-1" d="M 169.29,64.52 V 41.46 h -11.1 l -19.38,23.1 h -5.43 v -28.5 h -10.85 v 28.5 h -5.6 c 0,-0.53 0.08,-1.14 0.08,-1.88 V 62 h -6.77 v 1.94 a 6.32,6.32 0 0 1 -0.37,2.63 1.68,1.68 0 0 1 -1.66,0.88 1.5,1.5 0 0 1 -1.42,-0.71 5,5 0 0 1 -0.32,-2.33 V 58.73 H 117 V 56 a 13,13 0 0 0 -0.85,-5.23 6.31,6.31 0 0 0 -2.92,-2.88 11.68,11.68 0 0 0 -5.43,-1.11 11.49,11.49 0 0 0 -4.76,0.93 5.75,5.75 0 0 0 -2.88,2.57 10.54,10.54 0 0 0 -0.89,4.76 v 7 a 20,20 0 0 0 0.13,2.5 h -3 c 0,-0.28 0,-0.56 0,-0.87 a 5.84,5.84 0 0 0 -1,-3.71 12.59,12.59 0 0 0 -4.47,-2.8 22,22 0 0 1 -3.6,-1.84 3,3 0 0 1 -1.22,-1.32 6,6 0 0 1 -0.19,-1.77 2.32,2.32 0 0 1 0.45,-1.52 1.7,1.7 0 0 1 1.39,-0.58 1.5,1.5 0 0 1 1.49,0.71 5.86,5.86 0 0 1 0.25,2.32 v 1.3 h 6.27 V 53 a 11.15,11.15 0 0 0 -0.2,-2.55 3.72,3.72 0 0 0 -1.08,-1.63 6.68,6.68 0 0 0 -2.67,-1.49 14.3,14.3 0 0 0 -4.38,-0.58 13.32,13.32 0 0 0 -4.54,0.71 5,5 0 0 0 -2.63,1.92 7.84,7.84 0 0 0 -0.78,4 6.85,6.85 0 0 0 0.73,3.28 c 0.47,0.89 1.88,1.93 4.17,3.09 3.84,1.92 4.6,2.43 4.85,2.66 a 3.55,3.55 0 0 1 0.59,2.49 3,3 0 0 1 -0.46,2 A 2,2 0 0 1 87.8,67.45 1.5,1.5 0 0 1 86.3,66.6 6.54,6.54 0 0 1 86,63.87 v -2 h -6.29 v 1.62 c 0,0.38 0,0.72 0,1.05 h -6 a 25.58,25.58 0 1 0 0,8.83 H 158 v 8.42 h 11.33 v -8.4 h 5 V 64.52 Z M 38.89,75.1 A 6.1,6.1 0 1 1 45,69 6.1,6.1 0 0 1 38.89,75.1 Z m 67.54,-20.86 a 7.57,7.57 0 0 1 0.24,-2.68 c 0.15,-0.34 0.53,-0.75 1.48,-0.75 a 1.36,1.36 0 0 1 1.35,0.84 7.39,7.39 0 0 1 0.25,2.59 v 2.23 h -3.32 z M 158,64.52 h -9.62 L 158,52.22 Z" transform="translate(-3.04,-2.5)" id="path858"/>
      </g>
      <text xml:space="preserve" style="font-weight:bold;font-stretch:condensed;font-size:8.61839px;font-family:Arial;-inkscape-font-specification:'Arial, Bold Condensed';fill:none;fill-opacity:1;fill-rule:evenodd;stroke:#000000;stroke-width:0.505292;stroke-opacity:1" x="48.089367" y="45.416836" id="text16" transform="scale(0.93916555,1.064775)"><tspan sodipodi:role="line" id="tspan16" style="fill:#96ca4f;fill-opacity:1;stroke:none;stroke-width:0.505292" x="48.089367" y="45.416836">D</tspan></text>
      <text xml:space="preserve" style="font-weight:bold;font-stretch:condensed;font-size:8.87389px;font-family:Arial;-inkscape-font-specification:'Arial, Bold Condensed';fill:none;fill-opacity:1;fill-rule:evenodd;stroke:#000000;stroke-width:0.505292;stroke-opacity:1" x="54.558205" y="48.250385" id="text16-9"><tspan sodipodi:role="line" id="tspan16-1" style="fill:#96ca4f;fill-opacity:1;stroke:none;stroke-width:0.505292" x="54.558205" y="48.250385">O</tspan></text>
      <g id="g1" transform="matrix(1.1426343,0,0,1.1426343,24.136464,-10.044912)" style="stroke-width:1.67137">
        <text xml:space="preserve" style="font-weight:bold;font-stretch:condensed;font-size:7.7611px;font-family:Arial;-inkscape-font-specification:'Arial, Bold Condensed';fill:none;fill-opacity:1;fill-rule:evenodd;stroke:#000000;stroke-width:0.442217;stroke-opacity:1" x="44.508698" y="51.014606" id="text16-5"><tspan sodipodi:role="line" id="tspan16-8" style="fill:#96ca4f;fill-opacity:1;stroke:none;stroke-width:0.442217" x="44.508698" y="51.014606">S</tspan></text>
      </g>
      <text xml:space="preserve" style="font-weight:bold;font-stretch:condensed;font-size:8.87389px;font-family:Arial;-inkscape-font-specification:'Arial, Bold Condensed';fill:#96ca4f;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:0.505292;stroke-opacity:1" x="65.022789" y="48.250385" id="text17"><tspan sodipodi:role="line" id="tspan17" style="stroke-width:0.505292" x="65.022789" y="48.250385">C</tspan></text>
    </g>
  </g>
</svg>
</a>

<ul class="px-4 my-10 ext-links">
  <li class="mt-1">
    <div class=" mb-1 menu-title hover:text-hi leading-none">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true" data-slot="icon" class="menu-chevron p-0 h-4 w-4 mb-px -mr-0.5 inline cursor-pointer rotate-270">
  <path fill-rule="evenodd" d="M5.22 8.22a.75.75 0 0 1 1.06 0L10 11.94l3.72-3.72a.75.75 0 1 1 1.06 1.06l-4.25 4.25a.75.75 0 0 1-1.06 0L5.22 9.28a.75.75 0 0 1 0-1.06Z" clip-rule="evenodd"/>
</svg>
      <span class="cursor-pointer text-sm">Getting Started</span>
    </div>
    <ul class="menu-content ml-6 ">
        <li class="text-light bordercol pb-1 pl-3 border-l-1 text-sm leading-5 hover:text-hi">
          <a href="/getting-started.html">Overview</a>
        </li>
        <li class="text-light bordercol pb-1 pl-3 border-l-1 text-sm leading-5 hover:text-hi">
          <a href="/Tutorials/">Tutorials</a>
        </li>
        <li class="text-light bordercol pb-1 pl-3 border-l-1 text-sm leading-5 hover:text-hi">
          <a href="/projects/dockerfiles/">Setting up with Docker</a>
        </li>
        <li class="text-light bordercol pb-1 pl-3 border-l-1 text-sm leading-5 hover:text-hi">
          <a href="/projects/buildsystem/repo-cheatsheet.html">Repo manifest cheat sheet</a>
        </li>
    </ul>
  </li>
  <li class="mt-1">
    <div class=" mb-1 menu-title hover:text-hi leading-none">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true" data-slot="icon" class="menu-chevron p-0 h-4 w-4 mb-px -mr-0.5 inline cursor-pointer rotate-270">
  <path fill-rule="evenodd" d="M5.22 8.22a.75.75 0 0 1 1.06 0L10 11.94l3.72-3.72a.75.75 0 1 1 1.06 1.06l-4.25 4.25a.75.75 0 0 1-1.06 0L5.22 9.28a.75.75 0 0 1 0-1.06Z" clip-rule="evenodd"/>
</svg>
      <span class="cursor-pointer text-sm">The seL4 Kernel</span>
    </div>
    <ul class="menu-content ml-6 ">
        <li class="text-light bordercol pb-1 pl-3 border-l-1 text-sm leading-5 hover:text-hi">
          <a href="/projects/sel4/">Overview</a>
        </li>
        <li class="text-light bordercol pb-1 pl-3 border-l-1 text-sm leading-5 hover:text-hi">
          <a href="/projects/buildsystem/host-dependencies.html">Setting up</a>
        </li>
      <li class="pl-3 pb-1 border-l-1 bordercol">
        <div class="text-sm  menu-title text-light hover:text-hi">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true" data-slot="icon" class="menu-chevron h-4 w-4 mb-0.5 -ml-2 -mr-0.5 inline cursor-pointer rotate-270">
  <path fill-rule="evenodd" d="M5.22 8.22a.75.75 0 0 1 1.06 0L10 11.94l3.72-3.72a.75.75 0 1 1 1.06 1.06l-4.25 4.25a.75.75 0 0 1-1.06 0L5.22 9.28a.75.75 0 0 1 0-1.06Z" clip-rule="evenodd"/>
</svg>
          <span class="cursor-pointer">Tutorial</span>
        </div>
        <ul class="menu-content ml-3 ">
            <li class="text-light bordercol pl-3 border-l-1 text-sm leading-5 hover:text-hi">
              <a href="/Tutorials/setting-up.html">Setting up</a>
            </li>
            <li class="text-light bordercol pl-3 border-l-1 text-sm leading-5 hover:text-hi">
              <a href="/Tutorials/get-the-tutorials.html">Getting the tutorials</a>
            </li>
            <li class="text-light bordercol pl-3 border-l-1 text-sm leading-5 hover:text-hi">
              <a href="/Tutorials/hello-world.html">Hello world</a>
            </li>
            <li class="text-light bordercol pl-3 border-l-1 text-sm leading-5 hover:text-hi">
              <a href="/Tutorials/capabilities.html">Capabilities</a>
            </li>
            <li class="text-light bordercol pl-3 border-l-1 text-sm leading-5 hover:text-hi">
              <a href="/Tutorials/untyped.html">Untyped</a>
            </li>
            <li class="text-light bordercol pl-3 border-l-1 text-sm leading-5 hover:text-hi">
              <a href="/Tutorials/mapping.html">Mapping</a>
            </li>
            <li class="text-light bordercol pl-3 border-l-1 text-sm leading-5 hover:text-hi">
              <a href="/Tutorials/threads.html">Threads</a>
            </li>
            <li class="text-light bordercol pl-3 border-l-1 text-sm leading-5 hover:text-hi">
              <a href="/Tutorials/ipc.html">IPC</a>
            </li>
            <li class="text-light bordercol pl-3 border-l-1 text-sm leading-5 hover:text-hi">
              <a href="/Tutorials/notifications.html">Notifications</a>
            </li>
            <li class="text-light bordercol pl-3 border-l-1 text-sm leading-5 hover:text-hi">
              <a href="/Tutorials/interrupts.html">Interrupts</a>
            </li>
            <li class="text-light bordercol pl-3 border-l-1 text-sm leading-5 hover:text-hi">
              <a href="/Tutorials/fault-handlers.html">Fault handling</a>
            </li>
            <li class="text-light bordercol pl-3 border-l-1 text-sm leading-5 hover:text-hi">
              <a href="/Tutorials/mcs.html">MCS</a>
            </li>
            <li class="text-light bordercol pl-3 border-l-1 text-sm leading-5 hover:text-hi">
              <a href="/Tutorials/seL4-end.html">End</a>
            </li>
        </ul>
      </li>
        <li class="text-light bordercol pb-1 pl-3 border-l-1 text-sm leading-5 hover:text-hi">
          <a href="/Tutorials/how-to-seL4.html">How-to</a>
        </li>
        <li class="text-light bordercol pb-1 pl-3 border-l-1 text-sm leading-5 hover:text-hi">
          <a href="/projects/sel4/api-doc.html">API docs</a>
        </li>
        <li class="text-light bordercol pb-1 pl-3 border-l-1 text-sm leading-5 hover:text-hi">
          <a href="/projects/sel4/manual.html">Manual</a>
        </li>
        <li class="text-light bordercol pb-1 pl-3 border-l-1 text-sm leading-5 hover:text-hi">
          <a href="/Hardware/">Supported platforms</a>
        </li>
        <li class="text-light bordercol pb-1 pl-3 border-l-1 text-sm leading-5 hover:text-hi">
          <a href="/projects/sel4/verified-configurations.html">Verified configurations</a>
        </li>
        <li class="text-light bordercol pb-1 pl-3 border-l-1 text-sm leading-5 hover:text-hi">
          <a href="/projects/sel4/configurations.html">Configurations</a>
        </li>
        <li class="text-light bordercol pb-1 pl-3 border-l-1 text-sm leading-5 hover:text-hi">
          <a href="/projects/buildsystem/standalone.html">Standalone seL4 builds</a>
        </li>
        <li class="text-light bordercol pb-1 pl-3 border-l-1 text-sm leading-5 hover:text-hi">
          <a href="/projects/sel4/bfgen.html">Bitfield generator</a>
        </li>
      <li class="pl-3 pb-1 border-l-1 bordercol">
        <div class="text-sm  menu-title text-light hover:text-hi">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true" data-slot="icon" class="menu-chevron h-4 w-4 mb-0.5 -ml-2 -mr-0.5 inline cursor-pointer rotate-270">
  <path fill-rule="evenodd" d="M5.22 8.22a.75.75 0 0 1 1.06 0L10 11.94l3.72-3.72a.75.75 0 1 1 1.06 1.06l-4.25 4.25a.75.75 0 0 1-1.06 0L5.22 9.28a.75.75 0 0 1 0-1.06Z" clip-rule="evenodd"/>
</svg>
          <span class="cursor-pointer">Testing &amp; benchmarking</span>
        </div>
        <ul class="menu-content ml-3 ">
            <li class="text-light bordercol pl-3 border-l-1 text-sm leading-5 hover:text-hi">
              <a href="/projects/sel4test/">seL4test</a>
            </li>
            <li class="text-light bordercol pl-3 border-l-1 text-sm leading-5 hover:text-hi">
              <a href="/projects/sel4-tutorials/debugging-guide.html">Debugging guide</a>
            </li>
            <li class="text-light bordercol pl-3 border-l-1 text-sm leading-5 hover:text-hi">
              <a href="/projects/sel4-tutorials/debugging-userspace.html">Debugging user space</a>
            </li>
            <li class="text-light bordercol pl-3 border-l-1 text-sm leading-5 hover:text-hi">
              <a href="/projects/sel4bench/">sel4bench</a>
            </li>
            <li class="text-light bordercol pl-3 border-l-1 text-sm leading-5 hover:text-hi">
              <a href="/projects/sel4-tutorials/benchmarking-guide.html">Benchmarking guide</a>
            </li>
        </ul>
      </li>
        <li class="text-light bordercol pb-1 pl-3 border-l-1 text-sm leading-5 hover:text-hi">
          <a href="/projects/sel4/kernel-contribution.html">Contributing</a>
        </li>
        <li class="text-light bordercol pb-1 pl-3 border-l-1 text-sm leading-5 hover:text-hi">
          <a href="/projects/sel4/porting.html">Porting to a new platform</a>
        </li>
        <li class="text-light bordercol pb-1 pl-3 border-l-1 text-sm leading-5 hover:text-hi">
          <a href="/releases/seL4.html">Releases</a>
        </li>
        <li class="text-light bordercol pb-1 pl-3 border-l-1 text-sm leading-5 hover:text-hi">
          <a href="https://github.com/seL4/seL4">Sources</a>
        </li>
    </ul>
  </li>
<li class="-mt-2">&nbsp;</li>
  <li class="mt-1">
    <div class=" mb-1 menu-title hover:text-hi leading-none">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true" data-slot="icon" class="menu-chevron p-0 h-4 w-4 mb-px -mr-0.5 inline cursor-pointer rotate-270">
  <path fill-rule="evenodd" d="M5.22 8.22a.75.75 0 0 1 1.06 0L10 11.94l3.72-3.72a.75.75 0 1 1 1.06 1.06l-4.25 4.25a.75.75 0 0 1-1.06 0L5.22 9.28a.75.75 0 0 1 0-1.06Z" clip-rule="evenodd"/>
</svg>
      <span class="cursor-pointer text-sm">Microkit</span>
    </div>
    <ul class="menu-content ml-6 ">
        <li class="text-light bordercol pb-1 pl-3 border-l-1 text-sm leading-5 hover:text-hi">
          <a href="/projects/microkit/">Overview</a>
        </li>
        <li class="text-light bordercol pb-1 pl-3 border-l-1 text-sm leading-5 hover:text-hi">
          <a href="/projects/microkit/setting-up.html">Setting up your machine</a>
        </li>
      <li class="pl-3 pb-1 border-l-1 bordercol">
        <div class="text-sm  menu-title text-light hover:text-hi">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true" data-slot="icon" class="menu-chevron h-4 w-4 mb-0.5 -ml-2 -mr-0.5 inline cursor-pointer rotate-270">
  <path fill-rule="evenodd" d="M5.22 8.22a.75.75 0 0 1 1.06 0L10 11.94l3.72-3.72a.75.75 0 1 1 1.06 1.06l-4.25 4.25a.75.75 0 0 1-1.06 0L5.22 9.28a.75.75 0 0 1 0-1.06Z" clip-rule="evenodd"/>
</svg>
          <span class="cursor-pointer">Tutorial</span>
        </div>
        <ul class="menu-content ml-3 ">
            <li class="text-light bordercol pl-3 border-l-1 text-sm leading-5 hover:text-hi">
              <a href="/projects/microkit/tutorial/welcome.html">Welcome</a>
            </li>
            <li class="text-light bordercol pl-3 border-l-1 text-sm leading-5 hover:text-hi">
              <a href="/projects/microkit/tutorial/part0.html">Part 0 - Setting up</a>
            </li>
            <li class="text-light bordercol pl-3 border-l-1 text-sm leading-5 hover:text-hi">
              <a href="/projects/microkit/tutorial/part1.html">Part 1 - Serial server</a>
            </li>
            <li class="text-light bordercol pl-3 border-l-1 text-sm leading-5 hover:text-hi">
              <a href="/projects/microkit/tutorial/part2.html">Part 2 - Client</a>
            </li>
            <li class="text-light bordercol pl-3 border-l-1 text-sm leading-5 hover:text-hi">
              <a href="/projects/microkit/tutorial/part3.html">Part 3 - Wordle server</a>
            </li>
            <li class="text-light bordercol pl-3 border-l-1 text-sm leading-5 hover:text-hi">
              <a href="/projects/microkit/tutorial/part4.html">Part 4 - Virtual machines</a>
            </li>
            <li class="text-light bordercol pl-3 border-l-1 text-sm leading-5 hover:text-hi">
              <a href="/projects/microkit/tutorial/end.html">End</a>
            </li>
        </ul>
      </li>
        <li class="text-light bordercol pb-1 pl-3 border-l-1 text-sm leading-5 hover:text-hi">
          <a href="/projects/microkit/manual/latest/">Manual</a>
        </li>
        <li class="text-light bordercol pb-1 pl-3 border-l-1 text-sm leading-5 hover:text-hi">
          <a href="/projects/microkit/roadmap.html">Roadmap</a>
        </li>
        <li class="text-light bordercol pb-1 pl-3 border-l-1 text-sm leading-5 hover:text-hi">
          <a href="/projects/microkit/platforms.html">Supported platforms</a>
        </li>
        <li class="text-light bordercol pb-1 pl-3 border-l-1 text-sm leading-5 hover:text-hi">
          <a href="/releases/microkit.html">Releases</a>
        </li>
        <li class="text-light bordercol pb-1 pl-3 border-l-1 text-sm leading-5 hover:text-hi">
          <a href="https://github.com/seL4/microkit">Sources</a>
        </li>
    </ul>
  </li>
  <li class="mt-1">
    <div class="font-bold mb-1 menu-title hover:text-hi leading-none">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true" data-slot="icon" class="menu-chevron p-0 h-4 w-4 mb-px -mr-0.5 inline cursor-pointer ">
  <path fill-rule="evenodd" d="M5.22 8.22a.75.75 0 0 1 1.06 0L10 11.94l3.72-3.72a.75.75 0 1 1 1.06 1.06l-4.25 4.25a.75.75 0 0 1-1.06 0L5.22 9.28a.75.75 0 0 1 0-1.06Z" clip-rule="evenodd"/>
</svg>
      <span class="cursor-pointer text-sm">CAmkES</span>
    </div>
    <ul class="menu-content ml-6 on">
        <li class="text-light bordercol pb-1 pl-3 border-l-1 text-sm leading-5 hover:text-hi">
          <a href="/projects/camkes/">Overview</a>
        </li>
        <li class="text-light bordercol pb-1 pl-3 border-l-1 text-sm leading-5 hover:text-hi">
          <a href="/projects/camkes/setting-up.html">Setting up your machine</a>
        </li>
      <li class="pl-3 pb-1 border-l-1 bordercol">
        <div class="text-sm font-bold menu-title text-light hover:text-hi">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true" data-slot="icon" class="menu-chevron h-4 w-4 mb-0.5 -ml-2 -mr-0.5 inline cursor-pointer ">
  <path fill-rule="evenodd" d="M5.22 8.22a.75.75 0 0 1 1.06 0L10 11.94l3.72-3.72a.75.75 0 1 1 1.06 1.06l-4.25 4.25a.75.75 0 0 1-1.06 0L5.22 9.28a.75.75 0 0 1 0-1.06Z" clip-rule="evenodd"/>
</svg>
          <span class="cursor-pointer">Tutorials</span>
        </div>
        <ul class="menu-content ml-3 on">
            <li class="text-light bordercol pl-3 border-l-1 text-sm leading-5 hover:text-hi">
              <a href="/Tutorials/hello-camkes-0.html">Hello CAmkES</a>
            </li>
            <li class="text-light bordercol pl-3 border-l-1 text-sm leading-5 hover:text-hi">
              <a href="/Tutorials/hello-camkes-1.html">Introduction</a>
            </li>
            <li class="text-light bordercol pl-3 border-l-1 text-sm leading-5 hover:text-hi">
              <a href="/Tutorials/hello-camkes-2.html">Events</a>
            </li>
            <li class="text-light bordercol pl-3 border-l-1 text-sm leading-5 hover:text-hi">
              <a href="/Tutorials/hello-camkes-timer.html">Timer</a>
            </li>
            <li class="text-light bordercol pl-3 border-l-1 text-sm leading-5 hover:text-hi">
              <a href="/Tutorials/camkes-vm-linux.html">Virtual Machines</a>
            </li>
            <li class="text-hi border-f_green-500 pl-3 border-l-1 text-sm leading-5 hover:text-hi">
              <a href="/Tutorials/camkes-vm-crossvm.html">Cross-VM connectors</a>
            </li>
        </ul>
      </li>
        <li class="text-light bordercol pb-1 pl-3 border-l-1 text-sm leading-5 hover:text-hi">
          <a href="/Tutorials/how-to-CAmkES.html">How-to</a>
        </li>
        <li class="text-light bordercol pb-1 pl-3 border-l-1 text-sm leading-5 hover:text-hi">
          <a href="/projects/camkes/manual.html">Manual</a>
        </li>
        <li class="text-light bordercol pb-1 pl-3 border-l-1 text-sm leading-5 hover:text-hi">
          <a href="/projects/camkes/hardware.html">Supported platforms</a>
        </li>
      <li class="pl-3 pb-1 border-l-1 bordercol">
        <div class="text-sm  menu-title text-light hover:text-hi">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true" data-slot="icon" class="menu-chevron h-4 w-4 mb-0.5 -ml-2 -mr-0.5 inline cursor-pointer rotate-270">
  <path fill-rule="evenodd" d="M5.22 8.22a.75.75 0 0 1 1.06 0L10 11.94l3.72-3.72a.75.75 0 1 1 1.06 1.06l-4.25 4.25a.75.75 0 0 1-1.06 0L5.22 9.28a.75.75 0 0 1 0-1.06Z" clip-rule="evenodd"/>
</svg>
          <span class="cursor-pointer">Virtualisation</span>
        </div>
        <ul class="menu-content ml-3 ">
            <li class="text-light bordercol pl-3 border-l-1 text-sm leading-5 hover:text-hi">
              <a href="/projects/camkes-vm/">CAmkES VM</a>
            </li>
            <li class="text-light bordercol pl-3 border-l-1 text-sm leading-5 hover:text-hi">
              <a href="/projects/virtualization/docs/libsel4vm.html">VM library</a>
            </li>
            <li class="text-light bordercol pl-3 border-l-1 text-sm leading-5 hover:text-hi">
              <a href="/projects/virtualization/docs/libsel4vmm.html">VMM library</a>
            </li>
        </ul>
      </li>
        <li class="text-light bordercol pb-1 pl-3 border-l-1 text-sm leading-5 hover:text-hi">
          <a href="/releases/camkes.html">Releases</a>
        </li>
        <li class="text-light bordercol pb-1 pl-3 border-l-1 text-sm leading-5 hover:text-hi">
          <a href="https://github.com/seL4/camkes-tool/">Sources</a>
        </li>
    </ul>
  </li>
<li class="-mt-2">&nbsp;</li>
  <li class="mt-1">
    <div class=" mb-1 menu-title hover:text-hi leading-none">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true" data-slot="icon" class="menu-chevron p-0 h-4 w-4 mb-px -mr-0.5 inline cursor-pointer rotate-270">
  <path fill-rule="evenodd" d="M5.22 8.22a.75.75 0 0 1 1.06 0L10 11.94l3.72-3.72a.75.75 0 1 1 1.06 1.06l-4.25 4.25a.75.75 0 0 1-1.06 0L5.22 9.28a.75.75 0 0 1 0-1.06Z" clip-rule="evenodd"/>
</svg>
      <span class="cursor-pointer text-sm">C support</span>
    </div>
    <ul class="menu-content ml-6 ">
        <li class="text-light bordercol pb-1 pl-3 border-l-1 text-sm leading-5 hover:text-hi">
          <a href="/projects/sel4runtime/">C runtime</a>
        </li>
        <li class="text-light bordercol pb-1 pl-3 border-l-1 text-sm leading-5 hover:text-hi">
          <a href="/projects/user_libs/">User-level libraries</a>
        </li>
        <li class="text-light bordercol pb-1 pl-3 border-l-1 text-sm leading-5 hover:text-hi">
          <a href="/projects/buildsystem/">Build System</a>
        </li>
      <li class="pl-3 pb-1 border-l-1 bordercol">
        <div class="text-sm  menu-title text-light hover:text-hi">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true" data-slot="icon" class="menu-chevron h-4 w-4 mb-0.5 -ml-2 -mr-0.5 inline cursor-pointer rotate-270">
  <path fill-rule="evenodd" d="M5.22 8.22a.75.75 0 0 1 1.06 0L10 11.94l3.72-3.72a.75.75 0 1 1 1.06 1.06l-4.25 4.25a.75.75 0 0 1-1.06 0L5.22 9.28a.75.75 0 0 1 0-1.06Z" clip-rule="evenodd"/>
</svg>
          <span class="cursor-pointer">Tutorials</span>
        </div>
        <ul class="menu-content ml-3 ">
            <li class="text-light bordercol pl-3 border-l-1 text-sm leading-5 hover:text-hi">
              <a href="/Tutorials/libraries-1.html">Init & Threads</a>
            </li>
            <li class="text-light bordercol pl-3 border-l-1 text-sm leading-5 hover:text-hi">
              <a href="/Tutorials/libraries-2.html">IPC</a>
            </li>
            <li class="text-light bordercol pl-3 border-l-1 text-sm leading-5 hover:text-hi">
              <a href="/Tutorials/libraries-3.html">ELF loading & Processes</a>
            </li>
            <li class="text-light bordercol pl-3 border-l-1 text-sm leading-5 hover:text-hi">
              <a href="/Tutorials/libraries-4.html">Timer</a>
            </li>
        </ul>
      </li>
        <li class="text-light bordercol pb-1 pl-3 border-l-1 text-sm leading-5 hover:text-hi">
          <a href="/Tutorials/how-to-libs.html">How-to</a>
        </li>
    </ul>
  </li>
  <li class="mt-1">
    <div class=" mb-1 menu-title hover:text-hi leading-none">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true" data-slot="icon" class="menu-chevron p-0 h-4 w-4 mb-px -mr-0.5 inline cursor-pointer rotate-270">
  <path fill-rule="evenodd" d="M5.22 8.22a.75.75 0 0 1 1.06 0L10 11.94l3.72-3.72a.75.75 0 1 1 1.06 1.06l-4.25 4.25a.75.75 0 0 1-1.06 0L5.22 9.28a.75.75 0 0 1 0-1.06Z" clip-rule="evenodd"/>
</svg>
      <span class="cursor-pointer text-sm">Rust support</span>
    </div>
    <ul class="menu-content ml-6 ">
        <li class="text-light bordercol pb-1 pl-3 border-l-1 text-sm leading-5 hover:text-hi">
          <a href="/projects/rust/">Overview</a>
        </li>
        <li class="text-light bordercol pb-1 pl-3 border-l-1 text-sm leading-5 hover:text-hi">
          <a href="/projects/rust/how-to-use.html">How to use</a>
        </li>
        <li class="text-light bordercol pb-1 pl-3 border-l-1 text-sm leading-5 hover:text-hi">
          <a href="/projects/rust/tutorial/introduction.html">Tutorial</a>
        </li>
        <li class="text-light bordercol pb-1 pl-3 border-l-1 text-sm leading-5 hover:text-hi">
          <a href="https://sel4.github.io/rust-sel4/">API</a>
        </li>
        <li class="text-light bordercol pb-1 pl-3 border-l-1 text-sm leading-5 hover:text-hi">
          <a href="/projects/rust/supported-configurations.html">Supported configurations</a>
        </li>
        <li class="text-light bordercol pb-1 pl-3 border-l-1 text-sm leading-5 hover:text-hi">
          <a href="/projects/rust/releases.html">Releases</a>
        </li>
        <li class="text-light bordercol pb-1 pl-3 border-l-1 text-sm leading-5 hover:text-hi">
          <a href="https://github.com/seL4/rust-sel4">Sources</a>
        </li>
    </ul>
  </li>
<li class="-mt-2">&nbsp;</li>
  <li class="mt-1">
    <div class=" mb-1 menu-title hover:text-hi leading-none">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true" data-slot="icon" class="menu-chevron p-0 h-4 w-4 mb-px -mr-0.5 inline cursor-pointer rotate-270">
  <path fill-rule="evenodd" d="M5.22 8.22a.75.75 0 0 1 1.06 0L10 11.94l3.72-3.72a.75.75 0 1 1 1.06 1.06l-4.25 4.25a.75.75 0 0 1-1.06 0L5.22 9.28a.75.75 0 0 1 0-1.06Z" clip-rule="evenodd"/>
</svg>
      <span class="cursor-pointer text-sm">ELF loader</span>
    </div>
    <ul class="menu-content ml-6 ">
        <li class="text-light bordercol pb-1 pl-3 border-l-1 text-sm leading-5 hover:text-hi">
          <a href="/projects/elfloader/">ELF loader for C</a>
        </li>
    </ul>
  </li>
  <li class="mt-1">
    <div class=" mb-1 menu-title hover:text-hi leading-none">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true" data-slot="icon" class="menu-chevron p-0 h-4 w-4 mb-px -mr-0.5 inline cursor-pointer rotate-270">
  <path fill-rule="evenodd" d="M5.22 8.22a.75.75 0 0 1 1.06 0L10 11.94l3.72-3.72a.75.75 0 1 1 1.06 1.06l-4.25 4.25a.75.75 0 0 1-1.06 0L5.22 9.28a.75.75 0 0 1 0-1.06Z" clip-rule="evenodd"/>
</svg>
      <span class="cursor-pointer text-sm">capDL</span>
    </div>
    <ul class="menu-content ml-6 ">
        <li class="text-light bordercol pb-1 pl-3 border-l-1 text-sm leading-5 hover:text-hi">
          <a href="/projects/capdl/">Overview</a>
        </li>
        <li class="text-light bordercol pb-1 pl-3 border-l-1 text-sm leading-5 hover:text-hi">
          <a href="/projects/capdl/lang-spec.html">Language Spec</a>
        </li>
        <li class="text-light bordercol pb-1 pl-3 border-l-1 text-sm leading-5 hover:text-hi">
          <a href="/projects/capdl/c-loader-app.html">capDL loader (C)</a>
        </li>
        <li class="text-light bordercol pb-1 pl-3 border-l-1 text-sm leading-5 hover:text-hi">
          <a href="/releases/capDL.html">Releases</a>
        </li>
    </ul>
  </li>
<li class="-mt-2">&nbsp;</li>
  <li class="mt-1">
    <div class=" mb-1 menu-title hover:text-hi leading-none">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true" data-slot="icon" class="menu-chevron p-0 h-4 w-4 mb-px -mr-0.5 inline cursor-pointer rotate-270">
  <path fill-rule="evenodd" d="M5.22 8.22a.75.75 0 0 1 1.06 0L10 11.94l3.72-3.72a.75.75 0 1 1 1.06 1.06l-4.25 4.25a.75.75 0 0 1-1.06 0L5.22 9.28a.75.75 0 0 1 0-1.06Z" clip-rule="evenodd"/>
</svg>
      <span class="cursor-pointer text-sm">Examples &amp; demos</span>
    </div>
    <ul class="menu-content ml-6 ">
        <li class="text-light bordercol pb-1 pl-3 border-l-1 text-sm leading-5 hover:text-hi">
          <a href="/examples.html">Overview</a>
        </li>
    </ul>
  </li>
</ul>

      </div>
      <div id="sidebar-handle"
           class="flex-none relative cursor-col-resize min-h-full
                  bg-gray-200 dark:bg-gray-700 w-px">
      </div>
    </div>
    <div class="flex-1">
      
<div class="w-full pb-px bg-gray-200 dark:bg-gray-700">
  <header class="h-[2rem] sm:h-[2.5rem] lg:h-[3.5rem] w-full flex flex-row items-center gap-2 md:gap-4 md:py-2 std-bg">
    <div id="burger">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="text-dark ml-3 mr-0 sm:mr-3 lg:mx-4 w-4 h-4 lg:w-6 lg:h-6 cursor-pointer">
  <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5"/>
</svg>
    </div>
    <div class="flex-1"></div>
    <a href="/releases.html"
      class="text-lighter hover:text-light hover:underline text-tiny sm:text-xs lg:text-sm font-semibold">
      Releases
    </a>
    <a href="https://sel4.systems/Contribute/"
      class="text-lighter hover:text-light hover:underline text-tiny sm:text-xs lg:text-sm font-semibold">
      Contribute
    </a>
    <a href="https://sel4.systems/contact.html"
      class="text-lighter hover:text-light hover:underline text-tiny sm:text-xs lg:text-sm font-semibold">
      Contact
    </a>
    <a href="https://sel4.systems/support.html"
      class="text-lighter hover:text-light hover:underline text-tiny sm:text-xs lg:text-sm font-semibold">
      Support
    </a>
    <!-- main site button -->
    <a href="https://sel4.systems"
      class="flex-none button-outline ml-0 text-tiny px-2 py-0.5 sm:px-3 sm:py-1 h-4 sm:h-6 md:py-2 md:h-8 lg:h-9 md:text-xs lg:text-sm mr-0 md:mr-4">Main Site
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" aria-hidden="true" viewBox="0 0 24 24" stroke="currentColor" data-slot="icon" class="hidden sm:inline-icon">
<path stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" d="M13.5 6H5.25A2.25 2.25 0 0 0 3 8.25v10.5A2.25 2.25 0 0 0 5.25 21h10.5A2.25 2.25 0 0 0 18 18.75V10.5m-10.5 6L21 3m0 0h-5.25M21 3v5.25"/>
</svg>
    </a>
    <!-- github button -->
    <a href="https://github.com/seL4"
      class="mr-2 lg:mr-6 px-0 sm:px-3 pt-2 sm:pt-1 pb-2 block text-gray-400 dark:text-gray-500 hover:text-gray-500 dark:hover:text-gray-300">
      <span class="sr-only">seL4 on GitHub</span>
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor" aria-hidden="true" data-slot="icon" class="w-4 h-4 sm:w-5 sm:h-5 lg:w-6 lg:h-6">
<path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"/>
</svg>
    </a>
  </header>
</div>

      <div class="grid grid-cols-1 xl:grid-cols-[4rem_auto_4rem] h-[calc(100%-3rem)]">
        <div class="hidden xl:flex relative hover:bg-gray-100 dark:hover:bg-gray-800 items-center justify-center">
          <a href="camkes-vm-linux.html" class="mx-auto my-auto text-lighter">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="h-7 w-7 stroke-3">
  <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 19.5 8.25 12l7.5-7.5"/>
</svg>
            <span class="absolute inset-0"></span>
          </a>
          </div>
        <div class="flex flex-col max-w-full overflow-y-auto">
          <div id="main-div" class="flex-1 max-w-full">
            <main class="mx-6 md:mx-10 xl:mx-12 my-12
                        overflow-x-auto" id="page-top">

              <div class="theprose mx-auto ext-links">
  
<!--
  Copyright 2017, Data61, CSIRO (ABN 41 687 119 230)

  SPDX-License-Identifier: BSD-2-Clause
-->

<h1 id="camkes-cross-vm-connectors">CAmkES Cross VM Connectors</h1>

<p>This tutorial provides an introduction to using the cross virtual machine (VM) connector mechanisms
provided by seL4 and CAmkES in order to connect processes in a guest Linux instance to CAmkES components.</p>

<p>In this tutorial you will learn how to:</p>

<ul>
  <li>Configure processes in a Linux guest VM to communicate with CAmkES components</li>
</ul>

<h2 id="prerequisites">Prerequisites</h2>
<ol>
  <li><a href="/Tutorials/setting-up.html">Set up your machine</a></li>
  <li><a href="/Tutorials/camkes-vm-linux.html">CAmkES VM Linux tutorial</a></li>
</ol>

<p><em>Note that the instructions for this tutorial are only for Linux.</em></p>

<h2 id="initialising">Initialising</h2>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># For instructions about obtaining the tutorial sources see /Tutorials/get-the-tutorials</span>
<span class="c">#</span>
<span class="c"># Follow these instructions to initialise the tutorial</span>
<span class="c"># initialising the build directory with a tutorial exercise</span>
./init <span class="nt">--tut</span> camkes-vm-crossvm
<span class="c"># building the tutorial exercise</span>
<span class="nb">cd </span>camkes-vm-crossvm_build
ninja
</code></pre></div></div>

<details>
  <summary><em>Hint:</em> tutorial solutions</summary>

  <p>All tutorials come with complete solutions. To get solutions run:</p>

  <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># For instructions about obtaining the tutorial sources see /Tutorials/get-the-tutorials</span>
<span class="c">#</span>
<span class="c"># Follow these instructions to initialise the tutorial</span>
<span class="c"># initialising the build directory with a tutorial exercise</span>
./init <span class="nt">--solution</span> <span class="nt">--tut</span> camkes-vm-crossvm
<span class="c"># building the tutorial exercise</span>
<span class="nb">cd </span>camkes-vm-crossvm_build
ninja
</code></pre></div>  </div>

</details>

<h2 id="background">Background</h2>

<p>In order to connect guest Linux instances to CAmkES components,
three additional kernel modules must be installed in the guest.
These modules are included in the root filesystem by default:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">dataport</code>: facilitates setting up shared memory between the guest
and CAmkES components.</li>
  <li><code class="language-plaintext highlighter-rouge">consumes_event</code>: allows a process in the guest to wait or poll
for an event sent by a CAmkES component.</li>
  <li><code class="language-plaintext highlighter-rouge">emits_event</code>: allows a process to emit an event to a CAmkES component.</li>
</ul>

<p>Each type of module can be statically assigned to one or more file descriptors to associate that
file descriptor with a specific instance of an interface. <code class="language-plaintext highlighter-rouge">ioctl</code> can then be used to
manipulate that file descriptor and use the module.</p>

<h3 id="dataports">Dataports</h3>

<p>Dataports are the mechanism which allows guests and components to share memory.
The dataport initialisation process is as follows:</p>

<ul>
  <li>The guest process uses <code class="language-plaintext highlighter-rouge">ioctl</code> on on the file associated with the dataport and specify a
 page-aligned size for the shared memory.</li>
  <li>The dataport kernel module in the guest then allocates a page-aligned buffer of the requested size,
and makes a hypercall to the VMM, with the guest physical address and id of the data port.
The ID is derived from the file on which <code class="language-plaintext highlighter-rouge">ioctl</code> was called.</li>
  <li>The virtual machine manager (VMM) then modifies the guest’s address space, creating the shared memory region.
 between a camkes component and the guest.</li>
  <li>Linux processes can then map this memory into their own address space by calling <code class="language-plaintext highlighter-rouge">mmap</code> on the file
associated with the dataport.</li>
</ul>

<h3 id="emitting-events">Emitting Events</h3>

<p>Guest processes can emit events by using <code class="language-plaintext highlighter-rouge">ioctl</code> on files associated with the event interface.
This results in the <code class="language-plaintext highlighter-rouge">emits_event</code> kernel module in the guest making a
making a hypercall to the VMM, which triggers the event and resumes the guest.</p>

<h3 id="consuming-events">Consuming Events</h3>

<p>Linux process can wait or poll for an event by calling <code class="language-plaintext highlighter-rouge">poll</code>
on the file associated with that event, using the timeout argument to
specify whether or not it should block. The event it polls for is
<code class="language-plaintext highlighter-rouge">POLLIN</code>. When the VMM receives an event destined for the guest, it places
the event id in some memory shared between the VMM and the
<code class="language-plaintext highlighter-rouge">consumes_event</code> kernel module, and then injects an interrupt into the
guest. The <code class="language-plaintext highlighter-rouge">consumes_event</code> kernel module is registered to handle this
interrupt, which reads the event ID from shared memory, and wakes a
thread blocked on the corresponding event file. If no threads are
blocked on the file, some state is set in the module such that the next
time a process waits on that file, it returns immediately and clears the
state, mimicking the behaviour of notifications.</p>

<h2 id="exercises">Exercises</h2>

<p>In this tutorial you will
create a program that runs in the guest, and sends a string
to a CAmkES component to output. To achieve this, the guest program will write a string
to a shared buffer between itself and a CAmkES component. When its ready
for the string to be printed, it will emit an event, received by the
CAmkES component. The CAmkES component will print the string, then send
an event to the guest process so the guest knows it’s safe to send a new
string.</p>

<h3 id="add-modules-to-the-guest">Add modules to the guest</h3>

<p>There is a library in <code class="language-plaintext highlighter-rouge">projects/camkes/vm-linux/camkes-linux-artifacts/camkes-linux-apps/camkes-connector-apps/libs</code>
containing Linux system call wrappers, and some utility programs in
<code class="language-plaintext highlighter-rouge">projects/camkes/vm-linux/camkes-linux-artifacts/camkes-linux-apps/camkes-connector-apps/pkgs/{dataport,consumes_event,emits_event}</code>
which initialize and interact with cross VM connections. To build and use these modules in your rootfs the vm-linux
project provides an overlay target you can use.</p>

<p><strong>Exercise</strong> First add the <code class="language-plaintext highlighter-rouge">dataport</code>, <code class="language-plaintext highlighter-rouge">consumes_event</code> and <code class="language-plaintext highlighter-rouge">emits_event</code> kernel modules to the  rootfs in the guest.</p>

<p>Start by replacing the line:</p>

<div class="language-cmake highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">AddToFileServer</span><span class="p">(</span><span class="s2">"rootfs.cpio"</span> <span class="si">${</span><span class="nv">default_rootfs_file</span><span class="si">}</span><span class="p">)</span>
</code></pre></div></div>

<p>in the target applications <code class="language-plaintext highlighter-rouge">CMakeLists.txt</code> file with the following:</p>

<div class="language-cmake highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">set</span><span class="p">(</span>CAmkESVMDefaultBuildrootOverlay ON CACHE BOOL <span class="s2">""</span> FORCE<span class="p">)</span>
<span class="nf">AddOverlayDirToRootfs</span><span class="p">(</span>default_buildroot_overlay <span class="si">${</span><span class="nv">default_rootfs_file</span><span class="si">}</span> <span class="s2">"buildroot"</span> <span class="s2">"rootfs_install"</span>
    rootfs_file rootfs_target<span class="p">)</span>
<span class="nf">AddToFileServer</span><span class="p">(</span><span class="s2">"rootfs.cpio"</span> <span class="si">${</span><span class="nv">rootfs_file</span><span class="si">}</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="define-interfaces-in-the-vmm">Define interfaces in the VMM</h3>

<p><strong>Exercise</strong> Update the CAmkES file, <code class="language-plaintext highlighter-rouge">crossvm_tutorial.camkes</code> by replacing the Init0 component definition:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">component</span> <span class="n">Init0</span> <span class="p">{</span>
    <span class="n">VM_INIT_DEF</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></div></div>

<p>with the following definition:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">component</span> <span class="n">Init0</span> <span class="p">{</span>
  <span class="n">VM_INIT_DEF</span><span class="p">()</span>

  <span class="c1">// this is the data port for shared memory between the component and guest process</span>
  <span class="n">dataport</span> <span class="n">Buf</span><span class="p">(</span><span class="mi">4096</span><span class="p">)</span> <span class="n">data</span><span class="p">;</span>
  <span class="c1">// this event tells the component that there is data ready to print</span>
  <span class="n">emits</span> <span class="n">DoPrint</span> <span class="n">do_print</span><span class="p">;</span>
  <span class="c1">// this event tells the guest process that priting is complete</span>
  <span class="n">consumes</span> <span class="n">DonePrinting</span> <span class="n">done_printing</span><span class="p">;</span>
  <span class="c1">// this mutex protects access to shared state between the VMM and the guest Linux</span>
  <span class="n">has</span> <span class="n">mutex</span> <span class="n">cross_vm_event_mutex</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>These interfaces will eventually be made visible to processes running in
the guest linux. The mutex is used to protect access to shared state
between the VMM and guest.</p>

<h3 id="define-the-component-interface">Define the component interface</h3>

<p><strong>Exercise</strong> Define the print server component by adding the following to
the <code class="language-plaintext highlighter-rouge">crossvm_tutorial.camkes</code> file, after the <code class="language-plaintext highlighter-rouge">Init0</code> definition:</p>
<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">component</span> <span class="n">PrintServer</span> <span class="p">{</span>
  <span class="n">control</span><span class="p">;</span>
  <span class="n">dataport</span> <span class="n">Buf</span><span class="p">(</span><span class="mi">4096</span><span class="p">)</span> <span class="n">data</span><span class="p">;</span>
  <span class="n">consumes</span> <span class="n">DoPrint</span> <span class="n">do_print</span><span class="p">;</span>
  <span class="n">emits</span> <span class="n">DonePrinting</span> <span class="n">done_printing</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="instantiate-the-print-server">Instantiate the print server</h3>

<p><strong>Exercise</strong> Replace the <code class="language-plaintext highlighter-rouge">composition</code> definition:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="n">composition</span> <span class="p">{</span>
        <span class="n">VM_COMPOSITION_DEF</span><span class="p">()</span>
        <span class="n">VM_PER_VM_COMP_DEF</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="p">}</span>
</code></pre></div></div>

<p>with the following:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="n">composition</span> <span class="p">{</span>
        <span class="n">VM_COMPOSITION_DEF</span><span class="p">()</span>
        <span class="n">VM_PER_VM_COMP_DEF</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="n">component</span> <span class="n">PrintServer</span> <span class="n">print_server</span><span class="p">;</span>
        <span class="n">connection</span> <span class="n">seL4Notification</span> <span class="n">conn_do_print</span><span class="p">(</span><span class="n">from</span> <span class="n">vm0</span><span class="p">.</span><span class="n">do_print</span><span class="p">,</span>
                                                 <span class="n">to</span> <span class="n">print_server</span><span class="p">.</span><span class="n">do_print</span><span class="p">);</span>
        <span class="n">connection</span> <span class="n">seL4Notification</span> <span class="n">conn_done_printing</span><span class="p">(</span><span class="n">from</span> <span class="n">print_server</span><span class="p">.</span><span class="n">done_printing</span><span class="p">,</span>
                                                      <span class="n">to</span> <span class="n">vm0</span><span class="p">.</span><span class="n">done_printing</span><span class="p">);</span>

        <span class="n">connection</span> <span class="n">seL4SharedDataWithCaps</span> <span class="n">conn_data</span><span class="p">(</span><span class="n">from</span> <span class="n">print_server</span><span class="p">.</span><span class="n">data</span><span class="p">,</span>
                                                    <span class="n">to</span> <span class="n">vm0</span><span class="p">.</span><span class="n">data</span><span class="p">);</span>
    <span class="p">}</span>
</code></pre></div></div>

<p>The <a href="/projects/camkes/seL4SharedDataWithCaps.html">seL4SharedDataWithCaps</a>
connector is a dataport connector much like <code class="language-plaintext highlighter-rouge">seL4SharedData</code>.
However, the <code class="language-plaintext highlighter-rouge">to</code> side of the connection also receives access to
the capabilities to the frames backing the dataport, which is required
for cross VM dataports, as the VMM must be able to establish shared memory
at runtime by inserting new mappings into the guest’s address space.</p>

<p><strong>Exercise</strong> Interfaces connected with <a href="/projects/camkes/seL4SharedDataWithCaps.html">seL4SharedDataWithCaps</a> must be
configured with an integer specifying the ID and size of the dataport.
 Do this now by modifying <code class="language-plaintext highlighter-rouge">crossvm_tutorial.camkes</code> with the following
two lines in the configuration section:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="n">configuration</span> <span class="p">{</span>
    <span class="p">...</span>
        <span class="c1">// Add the following 2 lines:</span>
        <span class="n">vm0</span><span class="p">.</span><span class="n">data_id</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="c1">// ids must be contiguous, starting from 1</span>
        <span class="n">vm0</span><span class="p">.</span><span class="n">data_size</span> <span class="o">=</span> <span class="mi">4096</span><span class="p">;</span>
    <span class="p">}</span>
</code></pre></div></div>

<h3 id="implement-the-print-server">Implement the print server</h3>

<p><strong>Exercise</strong> Add the file <code class="language-plaintext highlighter-rouge">components/print_server.c</code> with the following contents:</p>
<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include</span> <span class="cpf">&lt;camkes.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span>
<span class="kt">int</span> <span class="nf">run</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>

    <span class="k">while</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// wait for the next event</span>
        <span class="n">do_print_wait</span><span class="p">();</span>

        <span class="n">printf</span><span class="p">(</span><span class="s">"%s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="n">data</span><span class="p">);</span>

        <span class="c1">// signal that we are done printing</span>
        <span class="n">done_printing_emit</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>This provides a very simple component definition that loops forever, printing a string from
shared memory whenever an event is received then emitting an event.
The example code assumes that the shared buffer will contain a valid, null-terminated c string, which is not
 something you should do in practice.</p>

<h3 id="implement-the-vmm-side-of-the-connection">Implement the VMM side of the connection</h3>
<p>Create another c file that tells the VMM about the cross VM connections.
 This file must define 3 functions which initialize each type of cross vm interface:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">cross_vm_dataports_init</code></li>
  <li><code class="language-plaintext highlighter-rouge">cross_vm_emits_events_init</code></li>
  <li><code class="language-plaintext highlighter-rouge">cross_vm_consumes_events_init</code></li>
</ul>

<p><strong>Exercise</strong> Add a file <code class="language-plaintext highlighter-rouge">src/cross_vm.c</code> with the following contents:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include</span> <span class="cpf">&lt;sel4/sel4.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;camkes.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;camkes_mutex.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;camkes_consumes_event.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;camkes_emits_event.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;dataport_caps.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;cross_vm_consumes_event.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;cross_vm_emits_event.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;cross_vm_dataport.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;vmm/vmm.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;vspace/vspace.h&gt;</span><span class="cp">
</span>
<span class="c1">// this is defined in the dataport's glue code</span>
<span class="k">extern</span> <span class="n">dataport_caps_handle_t</span> <span class="n">data_handle</span><span class="p">;</span>

<span class="c1">// Array of dataport handles at positions corresponding to handle ids from spec</span>
<span class="k">static</span> <span class="n">dataport_caps_handle_t</span> <span class="o">*</span><span class="n">dataports</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nb">NULL</span><span class="p">,</span> <span class="c1">// entry 0 is NULL so ids correspond with indices</span>
    <span class="o">&amp;</span><span class="n">data_handle</span><span class="p">,</span>
<span class="p">};</span>

<span class="c1">// Array of consumed event callbacks and ids</span>
<span class="k">static</span> <span class="n">camkes_consumes_event_t</span> <span class="n">consumed_events</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="p">{</span> <span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="p">.</span><span class="n">reg_callback</span> <span class="o">=</span> <span class="n">done_printing_reg_callback</span> <span class="p">},</span>
<span class="p">};</span>

<span class="c1">// Array of emitted event emit functions</span>
<span class="k">static</span> <span class="n">camkes_emit_fn</span> <span class="n">emitted_events</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nb">NULL</span><span class="p">,</span>   <span class="c1">// entry 0 is NULL so ids correspond with indices</span>
    <span class="n">do_print_emit</span><span class="p">,</span>
<span class="p">};</span>

<span class="c1">// mutex to protect shared event context</span>
<span class="k">static</span> <span class="n">camkes_mutex_t</span> <span class="n">cross_vm_event_mutex</span> <span class="o">=</span> <span class="p">(</span><span class="n">camkes_mutex_t</span><span class="p">)</span> <span class="p">{</span>
    <span class="p">.</span><span class="n">lock</span> <span class="o">=</span> <span class="n">cross_vm_event_mutex_lock</span><span class="p">,</span>
    <span class="p">.</span><span class="n">unlock</span> <span class="o">=</span> <span class="n">cross_vm_event_mutex_unlock</span><span class="p">,</span>
<span class="p">};</span>

<span class="kt">int</span> <span class="nf">cross_vm_dataports_init</span><span class="p">(</span><span class="n">vmm_t</span> <span class="o">*</span><span class="n">vmm</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">cross_vm_dataports_init_common</span><span class="p">(</span><span class="n">vmm</span><span class="p">,</span> <span class="n">dataports</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">dataports</span><span class="p">)</span><span class="o">/</span><span class="k">sizeof</span><span class="p">(</span><span class="n">dataports</span><span class="p">[</span><span class="mi">0</span><span class="p">]));</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">cross_vm_emits_events_init</span><span class="p">(</span><span class="n">vmm_t</span> <span class="o">*</span><span class="n">vmm</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">cross_vm_emits_events_init_common</span><span class="p">(</span><span class="n">vmm</span><span class="p">,</span> <span class="n">emitted_events</span><span class="p">,</span>
            <span class="k">sizeof</span><span class="p">(</span><span class="n">emitted_events</span><span class="p">)</span><span class="o">/</span><span class="k">sizeof</span><span class="p">(</span><span class="n">emitted_events</span><span class="p">[</span><span class="mi">0</span><span class="p">]));</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">cross_vm_consumes_events_init</span><span class="p">(</span><span class="n">vmm_t</span> <span class="o">*</span><span class="n">vmm</span><span class="p">,</span> <span class="n">vspace_t</span> <span class="o">*</span><span class="n">vspace</span><span class="p">,</span> <span class="n">seL4_Word</span> <span class="n">irq_badge</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">cross_vm_consumes_events_init_common</span><span class="p">(</span><span class="n">vmm</span><span class="p">,</span> <span class="n">vspace</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">cross_vm_event_mutex</span><span class="p">,</span>
            <span class="n">consumed_events</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">consumed_events</span><span class="p">)</span><span class="o">/</span><span class="k">sizeof</span><span class="p">(</span><span class="n">consumed_events</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">irq_badge</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="update-the-build-system">Update the build system</h3>

<p><strong>Exercise</strong> Make the following changes in <code class="language-plaintext highlighter-rouge">CMakeLists.txt</code> by firstly replacing the declaration of Init0:</p>

<div class="language-cmake highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">DeclareCAmkESVM</span><span class="p">(</span>Init0<span class="p">)</span>
</code></pre></div></div>

<p>with the following declaration:</p>

<div class="language-cmake highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Retrieve Init0 cross vm src files</span>
<span class="nb">file</span><span class="p">(</span>GLOB init0_extra src/*.c<span class="p">)</span>
<span class="c1"># Declare VM component: Init0</span>
<span class="nf">DeclareCAmkESVM</span><span class="p">(</span>Init0
    EXTRA_SOURCES <span class="si">${</span><span class="nv">init0_extra</span><span class="si">}</span>
    EXTRA_LIBS crossvm
<span class="p">)</span>
</code></pre></div></div>

<p>Also add a declaration for a PrintServer component:</p>

<div class="language-cmake highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Declare the CAmkES PrintServer component</span>
<span class="nf">DeclareCAmkESComponent</span><span class="p">(</span>PrintServer SOURCES components/print_server.c<span class="p">)</span>
</code></pre></div></div>

<p>This extends the definition of the Init component with the <code class="language-plaintext highlighter-rouge">cross_vm connector</code> source and the crossvm
library, and defines the new CAmkES component <code class="language-plaintext highlighter-rouge">PrintServer</code>.</p>

<h3 id="add-interfaces-to-the-guest">Add interfaces to the Guest</h3>

<p><strong>Exercise</strong> Create the following <code class="language-plaintext highlighter-rouge">camkes_init</code> shell script that is executed as Linux is initialized:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/sh</span>
<span class="c"># Initialises linux-side of cross vm connections.</span>

<span class="c"># Dataport sizes must match those in the camkes spec.</span>
<span class="c"># For each argument to dataport_init, the nth pair</span>
<span class="c"># corresponds to the dataport with id n.</span>
dataport_init /dev/camkes_data 4096

<span class="c"># The nth argument to event_init corresponds to the</span>
<span class="c"># event with id n according to the camkes vmm.</span>
consumes_event_init /dev/camkes_done_printing
emits_event_init /dev/camkes_do_print
</code></pre></div></div>

<p>Each of these commands creates device nodes associated with a particular
Linux kernel module supporting cross VM communication. Each command
takes a list of device nodes to create, which must correspond to the IDs
assigned to interfaces in <code class="language-plaintext highlighter-rouge">crossvm_tutorial.camkes</code> and <code class="language-plaintext highlighter-rouge">cross_vm.c</code>. The
<code class="language-plaintext highlighter-rouge">dataport_init</code> command must also be passed the size of each dataport.</p>

<p>These changes will cause device nodes to be created which correspond to
the interfaces you added to the VMM component.</p>

<h3 id="create-a-process">Create a process</h3>

<p>Now make a process that uses the device nodes to communicate with the
print server.</p>

<p><strong>Exercise</strong> First create a new directory:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mkdir -p pkgs/print_client
</code></pre></div></div>

<p>with the following file <code class="language-plaintext highlighter-rouge">pkgs/print_client/print_client.c</code>:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include</span> <span class="cpf">&lt;string.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;assert.h&gt;</span><span class="cp">
</span>
<span class="cp">#include</span> <span class="cpf">&lt;sys/types.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;sys/stat.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;sys/mman.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;fcntl.h&gt;</span><span class="cp">
</span>
<span class="cp">#include</span> <span class="cpf">"dataport.h"</span><span class="cp">
#include</span> <span class="cpf">"consumes_event.h"</span><span class="cp">
#include</span> <span class="cpf">"emits_event.h"</span><span class="cp">
</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">argv</span><span class="p">[])</span> <span class="p">{</span>

    <span class="kt">int</span> <span class="n">data_fd</span> <span class="o">=</span> <span class="n">open</span><span class="p">(</span><span class="s">"/dev/camkes_data"</span><span class="p">,</span> <span class="n">O_RDWR</span><span class="p">);</span>
    <span class="n">assert</span><span class="p">(</span><span class="n">data_fd</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">);</span>

    <span class="kt">int</span> <span class="n">do_print_fd</span> <span class="o">=</span> <span class="n">open</span><span class="p">(</span><span class="s">"/dev/camkes_do_print"</span><span class="p">,</span> <span class="n">O_RDWR</span><span class="p">);</span>
    <span class="n">assert</span><span class="p">(</span><span class="n">do_print_fd</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">);</span>

    <span class="kt">int</span> <span class="n">done_printing_fd</span> <span class="o">=</span> <span class="n">open</span><span class="p">(</span><span class="s">"/dev/camkes_done_printing"</span><span class="p">,</span> <span class="n">O_RDWR</span><span class="p">);</span>
    <span class="n">assert</span><span class="p">(</span><span class="n">done_printing_fd</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">);</span>

    <span class="kt">char</span> <span class="o">*</span><span class="n">data</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="n">dataport_mmap</span><span class="p">(</span><span class="n">data_fd</span><span class="p">);</span>
    <span class="n">assert</span><span class="p">(</span><span class="n">data</span> <span class="o">!=</span> <span class="n">MAP_FAILED</span><span class="p">);</span>

    <span class="kt">ssize_t</span> <span class="n">dataport_size</span> <span class="o">=</span> <span class="n">dataport_get_size</span><span class="p">(</span><span class="n">data_fd</span><span class="p">);</span>
    <span class="n">assert</span><span class="p">(</span><span class="n">dataport_size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">);</span>

    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">argc</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">strncpy</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">argv</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">dataport_size</span><span class="p">);</span>
        <span class="n">emits_event_emit</span><span class="p">(</span><span class="n">do_print_fd</span><span class="p">);</span>
        <span class="n">consumes_event_wait</span><span class="p">(</span><span class="n">done_printing_fd</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="n">close</span><span class="p">(</span><span class="n">data_fd</span><span class="p">);</span>
    <span class="n">close</span><span class="p">(</span><span class="n">do_print_fd</span><span class="p">);</span>
    <span class="n">close</span><span class="p">(</span><span class="n">done_printing_fd</span><span class="p">);</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>This program prints each of its arguments on a separate line, by sending
each argument to the print server one at a time.</p>

<p><strong>Exercise</strong> Create <code class="language-plaintext highlighter-rouge">pkgs/print_client/CMakeLists.txt</code> for our client program:</p>

<div class="language-cmake highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cmake_minimum_required</span><span class="p">(</span>VERSION 3.8.2<span class="p">)</span>

<span class="nb">project</span><span class="p">(</span>print_client C<span class="p">)</span>

<span class="nb">file</span><span class="p">(</span>READ <span class="si">${</span><span class="nv">CMAKE_MODULE_PATH_FILE</span><span class="si">}</span> module_path<span class="p">)</span>
<span class="nb">list</span><span class="p">(</span>APPEND CMAKE_MODULE_PATH <span class="si">${</span><span class="nv">module_path</span><span class="si">}</span><span class="p">)</span>
<span class="nb">find_package</span><span class="p">(</span>camkes-vm-linux REQUIRED<span class="p">)</span>
<span class="nb">add_subdirectory</span><span class="p">(</span><span class="si">${</span><span class="nv">CAMKES_VM_LINUX_DIR</span><span class="si">}</span>/camkes-linux-artifacts/camkes-linux-apps/camkes-connector-apps/libs/camkes camkes<span class="p">)</span>

<span class="nb">add_executable</span><span class="p">(</span>print_client print_client.c<span class="p">)</span>
<span class="nb">target_link_libraries</span><span class="p">(</span>print_client camkeslinux<span class="p">)</span>
</code></pre></div></div>

<p><strong>Exercise</strong> Update our the VM apps <code class="language-plaintext highlighter-rouge">CMakeLists.txt</code>. Below the line:</p>

<div class="language-cmake highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">AddToFileServer</span><span class="p">(</span><span class="s2">"bzimage"</span> <span class="si">${</span><span class="nv">decompressed_kernel</span><span class="si">}</span> DEPENDS extract_linux_kernel<span class="p">)</span>
</code></pre></div></div>

<p>add the <code class="language-plaintext highlighter-rouge">ExternalProject</code> declaration to include the print application:</p>

<div class="language-cmake highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Get Custom toolchain for 32 bit Linux</span>
<span class="nb">include</span><span class="p">(</span>cross_compiling<span class="p">)</span>
<span class="nf">FindCustomPollyToolchain</span><span class="p">(</span>LINUX_32BIT_TOOLCHAIN <span class="s2">"linux-gcc-32bit-pic"</span><span class="p">)</span>
<span class="c1"># Declare our print server app external project</span>
<span class="nb">include</span><span class="p">(</span>ExternalProject<span class="p">)</span>
<span class="nb">file</span><span class="p">(</span>WRITE <span class="si">${</span><span class="nv">CMAKE_CURRENT_BINARY_DIR</span><span class="si">}</span>/module_path <span class="s2">"</span><span class="si">${</span><span class="nv">CMAKE_MODULE_PATH</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nf">ExternalProject_Add</span><span class="p">(</span>print_client-app
    SOURCE_DIR <span class="si">${</span><span class="nv">CMAKE_CURRENT_SOURCE_DIR</span><span class="si">}</span>/pkgs/print_client
    BINARY_DIR <span class="si">${</span><span class="nv">CMAKE_BINARY_DIR</span><span class="si">}</span>/print_client-app
    BUILD_ALWAYS ON
    STAMP_DIR <span class="si">${</span><span class="nv">CMAKE_CURRENT_BINARY_DIR</span><span class="si">}</span>/print_client-app-stamp
    EXCLUDE_FROM_ALL
    INSTALL_COMMAND <span class="s2">""</span>
    CMAKE_ARGS
        -DCMAKE_BUILD_TYPE=<span class="si">${</span><span class="nv">CMAKE_BUILD_TYPE</span><span class="si">}</span>
        -DCMAKE_TOOLCHAIN_FILE=<span class="si">${</span><span class="nv">LINUX_32BIT_TOOLCHAIN</span><span class="si">}</span>
        -DCMAKE_MODULE_PATH_FILE=<span class="si">${</span><span class="nv">CMAKE_CURRENT_BINARY_DIR</span><span class="si">}</span>/module_path
<span class="p">)</span>
<span class="c1"># Add the print client app to our overlay ('default_buildroot_overlay')</span>
<span class="nf">AddExternalProjFilesToOverlay</span><span class="p">(</span>print_client-app <span class="si">${</span><span class="nv">CMAKE_BINARY_DIR</span><span class="si">}</span>/print_client-app default_buildroot_overlay <span class="s2">"usr/sbin"</span>
    FILES print_client<span class="p">)</span>
</code></pre></div></div>

<p>Directly below this we also want to add our <code class="language-plaintext highlighter-rouge">camkes_init</code> script into the overlay. We place this into the VMs <code class="language-plaintext highlighter-rouge">init.d</code> directory so
the script is run on start up:</p>

<div class="language-cmake highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">AddFileToOverlayDir</span><span class="p">(</span><span class="s2">"S90camkes_init"</span> <span class="si">${</span><span class="nv">CMAKE_CURRENT_LIST_DIR</span><span class="si">}</span>/camkes_init <span class="s2">"etc/init.d"</span> default_buildroot_overlay<span class="p">)</span>
</code></pre></div></div>

<p>That’s it. Build and run the system, and you should see the following output:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>...
Creating dataport node /dev/camkes_data
Allocating 4096 bytes for /dev/camkes_data
Creating consuming event node /dev/camkes_done_printing
Creating emitting event node /dev/camkes_do_print

Welcome to Buildroot
buildroot login: root
Password:
# print_client hello world
[   12.730073] dataport received mmap for minor 1
hello
world
</code></pre></div></div>


</div>

<script src="/assets/js/toggle-markdown.js"></script>

            </main>
          </div>
          <nav class="flex xl:hidden flex-row justify-between items-center mb-12 text-lighter">
            <a href="camkes-vm-linux.html" class="flex-none bg-gray-100 dark:bg-gray-800 rounded py-3 px-5 ml-12">
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="h-5 w-5 stroke-2 md:h-7 md:w-7 md:stroke-3">
  <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 19.5 8.25 12l7.5-7.5"/>
</svg>
            </a>
            <div class="flex-1"></div>
            </nav>
<footer class="flex-none flex flex-row py-6 pl-8 pr-10 border-t-1 bordercol
               text-xs lg:text-sm font-semibold text-lighter">
  <a href="/sitemap.html"
     class="flex-none hover:text-light hover:underline">Sitemap</a>
  <a href="/processes/test-status.html"
     class="mx-1 px-1 lg:mx-2 lg:px-2 bordercol border-l-2 flex-none hover:text-light hover:underline">Test status</a>
  <div class="flex-1"></div>
<a href="https://github.com/seL4/docs/edit/master/Tutorials/camkes-vm-crossvm.md" class="flex-none  hover:text-light hover:underline">Edit
    page on GitHub</a>
</footer>

        </div>
        <div class="hidden xl:flex relative  flex items-center justify-center"></div>
        </div>
    </div>
  </body>
</html>
