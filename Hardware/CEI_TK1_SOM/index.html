<!DOCTYPE html>
<!--
     SPDX-License-Identifier: CC-BY-SA-4.0
     SPDX-FileCopyrightText: 2020 seL4 Project a Series of LF Projects, LLC.
-->
<!-- Page last generated 2024-08-14 03:15:26 +0000 -->
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>TK1 som | seL4 docs</title>

    <!-- Our stylesheet and theme stylesheet.  Contains bootstrap. -->
    <link rel="stylesheet" href="/assets/css/style.css" type="text/css">
    <!-- Font awesome -->
    <link href="https://use.fontawesome.com/releases/v5.0.8/css/all.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet">
    <!-- Pygments syntax highlighting  -->
    <link rel="stylesheet" href="/assets/css/highlighting/trac.css" type="text/css">
    <link rel="icon" type="image/x-icon" href="/assets/favicon.ico"><script defer data-domain="docs.sel4.systems"
	    src="https://analytics.sel4.systems/js/script.js"></script></head>

  <body class="container-fluid">

    



<header>
  <ul class="row menu">
    <li class="col-xs-12 col-md-2" >
            <a href="https://sel4.systems" class="skip-icon">
              <img class="img-responsive" src="/assets/logo-text-white.svg" alt="seL4 logo" />
            </a>
    </li>
    <li class="col-xs-12 col-md-10 menu">
      <nav aria-label="Banner links">
        <h2><a href="/GettingStarted">Getting Started</a></h2>
        <h2><a href="/processes">Contributing</a></h2>
        <h2><a href="/projects">Projects</a></h2>
        <h2><a href="/Tutorials">Tutorials</a></h2>
        <iframe title="DuckDuckGo search bar" src="https://duckduckgo.com/search.html?site=docs.sel4.systems&prefill=Search%20sel4.systems" style="overflow:hidden;margin-bottom:10px; padding:0;height:40px;float:right;border-width: 0px"></iframe>
      </nav>
    </li>
  </ul>
  <div class="clear"></div>
  
<div class="breadcrumbs bootstrap hidden-sm-down">
  <nav class="sel-breadcrumb" aria-label="Breadcrumb" >
    <ol class=" list-unstyled" vocab="http://schema.org/" typeof="BreadcrumbList">
      
      
        

        

        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
            <a property="item" typeof="WebPage" href="/">
              <span property="name"><b>seL4 Docs</b></span>
            </a>
            <meta property="position" content="1" />
        </li>
      
        

        

        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
            <a property="item" typeof="WebPage" href="/Hardware/">
              <span property="name"><b>Supported platforms</b></span>
            </a>
            <meta property="position" content="2" />
        </li>
      
        

        
          <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
            <span property="name">TK1 som</span>
            <meta property="position" content="3" /></li>
          
    </ol>
  </nav>
  <nav class="sel-version" aria-label="Current Versions">
    <ol class="list-unstyled">
      <li class="list-unstyled text-right" style="margin-left:auto; padding:0rem 0rem;">
        Current versions:</li>
      <li class="list-unstyled text-right">
      <a href="/releases/sel4/13.0.0"><b>seL4-13.0.0</b></a></li>
      <li class="list-unstyled text-right">
      <a href="/releases/microkit/1.4.0"><b>microkit-1.4.0</b></a></li>
      <li class="list-unstyled text-right">
      <a href="/releases/camkes/camkes-3.11.0"><b>camkes-3.11.0</b></a></li>
      <li class="list-unstyled text-right">
      <a href="/releases/capdl/0.3.0"><b>capDL-0.3.0</b></a></li>
      </ol>
  </nav>
  <div class='clear'></div>
</div>


</header>

    <main>
      <div class="row">
  <div class="hidden-xs col-sm-4 col-md-3 col-lg-2">
    


<div class="sidebar">


















</div>


  </div>
  <div class="col-sm-8 col-md-9 col-lg-8 main">
    
    <div class="content">
      <h1 id="tk1-som">TK1 som</h1>

<p>The TK1-SOM from Colorado engineering is a small form-factor system
based on the NVIDIA Tegra K1. Details and ordering are at
<a href="https://tk1som.com/products/tk1-som">https://tk1som.com/products/tk1-som</a></p>

<h2 id="hardware-modifications-and-daughterboards">Hardware modifications and Daughterboards</h2>

<p><a href="Tk1SomMods">Adding some missing connectors</a> makes this board a
bit easier to use.</p>

<p>We have also developed 2 daughterboards for the TK1-SOM</p>

<ul>
  <li>a <a href="CANBoard">CAN daughterboard</a>, that adds two CAN
      controllers on the SPI bus</li>
  <li>an <a href="DaughterBoard">I/O daughterboard</a> that adds CAN
      controllers, various sensors and power management</li>
</ul>

<h2 id="u-boot">U-Boot</h2>

<p>Upstream U-Boot now supports this board.</p>

<p>Follow the instructions for the <a href="../jetsontk1#flash-u-boot">Jetson TK1</a>, however:</p>

<ul>
  <li>use <a href="https://github.com/wom-bat/tegra-uboot-flasher-manifests">https://github.com/wom-bat/tegra-uboot-flasher-manifests</a>
      as the URL for repo</li>
  <li>don’t apply the patch to increase the console buffer size</li>
  <li>use cei-tk1-som (instead of jetson-tk1) as the board ID</li>
</ul>

<p>As with the <a href="../jetsontk1">Jetson</a> with this u-boot, set the
environment variable bootm_boot_mode to nonsec In this boot mode, the
standard Linux kernel will not boot: recompile with CONFIG_ARM_PSCI on
and CONFIG_CPU_IDLE off.</p>

<p>The Pinmux spreadsheet, for use with
<a href="https://github.com/NVIDIA/tegra-pinmux-scripts">https://github.com/NVIDIA/tegra-pinmux-scripts</a> is
<a href="/Hardware/CEI_TK1_SOM/CEI_TK1_SOM_customer_pinmux_v11.xlsm">here.</a></p>

<p>The original pinmux spreadsheet from Colorado is
<a href="/Hardware/CEI_TK1_SOM/tk1-som_pinmux_V2.4.xlsm">here</a></p>

<h2 id="accessing-the-mmc">Accessing the MMC</h2>
<p>Attach a USB cable
between the TK1-SOM’s OTG port and your host, then on the U-Boot console
type <code class="language-plaintext highlighter-rouge">ums mmc 0</code>.</p>

<p>A spinning wheel will appear on the console, and the entire MMC will be
presented as a USB storage device to your host. In the default
partitioning (as it comes from Colorado Engineering) partition 1 on the
device is the UBUNTU root partition.</p>

<p>The <a href="../GeneralARM#sd">instructions for booting from SD</a>
are also valid for booting from MMC.</p>

<h2 id="serial-connection">Serial Connection</h2>
<p>The serial port is at 1V8 levels on J8, as
follows: (pin one is farthest from the ground hole)</p>

<table>
  <thead>
    <tr>
      <th>Pin</th>
      <th>Function</th>
      <th>Direction</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>1</td>
      <td>Rx</td>
      <td>In</td>
    </tr>
    <tr>
      <td>2</td>
      <td>Tx</td>
      <td>Out</td>
    </tr>
    <tr>
      <td>3</td>
      <td>CTS</td>
      <td>In</td>
    </tr>
    <tr>
      <td>4</td>
      <td>RTS</td>
      <td>Out</td>
    </tr>
  </tbody>
</table>

<p>There is no ground connection. There is however an unpopulated hole next
to J8 that is connected to Ground. Alternatively one can use pin 1 of J5
on the bottom (PSU) board as a ground connection. The pins are
unlabelled; pin 1 is the one in the middle of the board, under the gap
between J5 and J7 on the GPU/processor board. It’s easiest to connect to
this if you unscrew and take the thing apart. Please do this at a
static-controlled workstation!</p>

<p>If you need 1V8 as a reference (VDIO on some FTDI connectors), it’s
available on the JTAG connector at pin 1. Pin one is the top right pin
if the ethernet port is to your left. It is marked with a dot on the
silk-screen.</p>

<p>Speed 115200 8bits no parity; the default Linux image has login ubuntu,
password ubuntu.</p>

<h2 id="peripherals">Peripherals</h2>
<p>We have an open-hardware CAN and I2C board available,
see <a href="CANBoard">CAN-Board</a></p>

<h2 id="dfu-loading-kernels-over-usb">DFU: Loading kernels over USB</h2>
<p>You can load seL4 kernels over USB using dfu-util. (you can also use fastboot,
but to boot a kernel over fastboot means making the ELF file produced
from the build system look like an ANDROID Linux kernel).</p>

<p>On the u-boot console do:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>setenv dfu_alt_info "kernel ram $loadaddr 0x1000000"
saveenv
</code></pre></div></div>
<p>once.</p>

<p>Then to boot, on the u-boot console do:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>dfu 0 ram 0
</code></pre></div></div>
<p>and on your host:</p>

<ul>
  <li>install dfu-util (one time only: apt-get install dfu-util)</li>
  <li>
    <p>connect to the TK1-SOM using a USB connector to the on-the-go
      port</p>
  </li>
  <li>
    <p>run dfu-util (you may need to run this with sudo)</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>dfu-util --device 0955:701a -a kernel -D sel4test-driver-image-arm-tk1 .
dfu-util --device 0955:701a -e
</code></pre></div>    </div>

    <p>(if the -e option isn’t supported you
can add -R to the above command or ignore it and manually Ctrl-C out
of dfu in u-boot on the TK1-SOM)</p>
  </li>
</ul>

<p>This will load the <code class="language-plaintext highlighter-rouge">sel4test-driver-image-arm-tk1</code> file onto the TK1-SOM
at address <code class="language-plaintext highlighter-rouge">$loadaddr</code>. You can then run it in uboot with</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bootefi $loadaddr
</code></pre></div></div>

<p>If you want, you can automate all this with:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>setenv bootcmd_dfu "dfu 0 ram 0; bootefi $loadaddr" saveenv
</code></pre></div></div>

<p>then just</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>run bootcmd_dfu
</code></pre></div></div>

<p>If you ‘‘always’’ want to do this you can do</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>setenv bootcmd "run bootcmd_dfu"
</code></pre></div></div>

<h1 id="booting-from-a-usb-storage-device">Booting from a USB storage device</h1>

<p>You can boot from a USB storage device, by plugging it into the blue
port (on the power supply board). Patches are pending upstream to enable
the other port too. Use a FAT32 or ext2 partition on the storage; put
your image on it. You can either use a syslinux-style menu, or can boot
directly.</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>usb start 
fatload usb 0:1 ${loadaddr} sel4test-image-arm 
bootelf ${loadaddr}
</code></pre></div></div>

<h1 id="using-l4t-from-cei">Using L4T from CEI</h1>

<p>CEI provides modifications to L4T and instructions for getting it
running on the TK1-SOM. Unfortunately these seem to only be available on
a private FTP site, so you’ll have to contact CEI for access to those.</p>

<p>Once you have access, follow the instructions in the README.txt.</p>

<p>If you have a recent distribution and use the instructions from
Colorado, you will end up with an unbootable system — the format of
the ext4 filesystem, created by the flash.sh script has features that
the u-boot and kernel cannot understand. The simple change is to build
an ext3 filesystem instead.</p>

<p>Do:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo env ROOTFS_TYPE=ext3 ./flash.sh -L bootloader/ardbeg/u-boot.bin tk1-som mmcblk0p1
</code></pre></div></div>
<p>instead of using the instructions in the Colorado-provided
README.txt</p>

<p>Alternatively we have a customised image that we use: more information
at <a href="L4TCan">L4TCan</a>.</p>

    </div>
  </div>
</div>

    </main>
    


<footer class="site-footer">

  <h2 class="footer-heading">seL4 docs</h2>

  <div class="footer-col-wrapper">

    <div class="col-md-2">
      



<ul class="social-media-list">
  <li><a href="https://github.com/sel4"><i class="fab fa-github"></i> <span class="username">sel4</span></a></li><li><a href="https://github.com/sel4proj"><i class="fab fa-github"></i> <span class="username">sel4proj</span></a></li>
</ul>

    </div>

    <div class="col-md-8">
      <ul class="list-unstyled">
        <li>
          This site is for displaying seL4 related documentation.  Pull requests are welcome.
        </li>
        
          <li>
            Site last updated: Mon Aug 5 20:49:07 2024 +1000 ea4f37832c
          </li>
          <li>
                Page last updated: Tue Dec 19 12:55:38 2023 +0100 31df039362
          </li>
        
      </ul>
    </div>
    <div class="col-md-2">
<a href="https://github.com/seL4/docs/blob/master/Hardware/CEI_TK1_SOM/index.md">View page on GitHub</a>
      <br />
      <a href="https://github.com/seL4/docs/edit/master/Hardware/CEI_TK1_SOM/index.md">Edit page on GitHub</a>
      <br />
      <a href="/sitemap">Sitemap</a>
    </div>

  </div>

</footer>

  </body>
</html>
