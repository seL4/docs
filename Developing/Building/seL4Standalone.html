<!DOCTYPE html>
<!-- Page last generated 2019-10-28 18:32:19 +1100 -->
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Stand-alone seL4 builds | seL4 docs</title>

    <!-- Our stylesheet and theme stylesheet.  Contains bootstrap. -->
    <link rel="stylesheet" href="/assets/css/style.css" type="text/css">
    <!-- Font awesome -->
    <link href="https://use.fontawesome.com/releases/v5.0.8/css/all.css" rel="stylesheet">
    <!-- Pygments syntax highlighting  -->
    <link rel="stylesheet" href="/assets/css/highlighting/trac.css" type="text/css"><!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-117737473-2"></script>
<script>
  if((window.doNotTrack === "1" || navigator.doNotTrack === "1" || navigator.doNotTrack === "yes" || navigator.msDoNotTrack === "1")) {
    window['ga-disable-UA-117737473-2'] = true;
  }
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-117737473-2');
</script>
</head>

  <body class="container-fluid">

    

<header>
  <ul class="row menu">
    <li class="col-xs-12 col-md-2" >
            <a href="/">
              <img class="img-responsive" src="/logos/logo-text-white.svg" alt="seL4 logo" />
            </a>
    </li>
    <li class="col-xs-12 col-md-10 menu">
      <nav aria-label="Banner links">
        <h2><a href="/Documentation">Documentation</a></h2>
        <h2><a href="/GettingStarted">Getting Started</a></h2>
        <h2><a href="/Tutorials">Tutorials</a></h2>
        <h2><a href="https://research.csiro.au/tsblog">Blog</a></h2>
        <iframe title="DuckDuckGo search bar" src="https://duckduckgo.com/search.html?site=docs.sel4.systems&prefill=Search%20sel4.systems" style="overflow:hidden;margin-bottom:10px; padding:0;height:40px;float:right;border-width: 0px"></iframe>
      </nav>
    </li>
  </ul>
  <div class="clear"></div>
  <div class="breadcrumbs bootstrap hidden-sm-down">
  <nav class="sel-breadcrumb" aria-label="Breadcrumb" >
    <ol class=" list-unstyled" vocab="http://schema.org/" typeof="BreadcrumbList">
      
      
        

        

        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
            <a property="item" typeof="WebPage" href="/">
              <span property="name"><b>seL4 Docs</b></span>
              <meta property="position" content="1" />
            </a>
        </li>
      
        

        

        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
            <a property="item" typeof="WebPage" href="/Developing/Building/">
              <span property="name"><b>System configuration and building</b></span>
              <meta property="position" content="2" />
            </a>
        </li>
      
        

        
          <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
            <span property="name">Stand-alone seL4 builds</span>
            <meta property="position" content="3" /></li>
          
    </ol>
  </nav>
  <nav class="sel-version" aria-label="Current Versions">
    <ol class="list-unstyled">
      <li class="list-unstyled text-right" style="margin-left:auto; padding:0rem 0rem;">
        Current versions:</li>
      <li class="list-unstyled text-right">
      <a href="/sel4_release/seL4_10.1.1"><b>seL4-10.1.1</b></a></li>
      <li class="list-unstyled text-right">
      <a href="/sel4_release/seL4_10.1.1-mcs"><b>seL4-10.1.1-mcs</b></a></li>
      <li class="list-unstyled text-right">
      <a href="/camkes_release/Camkes_3.7.0"><b>camkes-3.7.0</b></a></li>
    </ol>
  </nav>
  <div class='clear'></div>
</div>


</header>

    <main>
      <div class="row">
  <div class="hidden-xs col-sm-4 col-md-3 col-lg-2">
    <div class="sidebar">

    <h3>seL4</h3>
      <ul class="nav nav-sidebar">
  
        <li class="">
          <a class="" href="/GettingStarted.html">
            Getting Started
          </a>
        </li>
  
        <li class="">
          <a class="" href="/Developing/Building/">
            CMake Build System
          </a>
        </li>
  
        <li class="">
          <a class="" href="/FrequentlyAskedQuestions.html">
            FAQ
          </a>
        </li>
  
        <li class="">
          <a class="" href="/Hardware/">
            Hardware
          </a>
        </li>
  
        <li class="">
          <a class="" href="/CAmkES/">
            CAmkES
          </a>
        </li>
  
        <li class="">
          <a class="" href="/sel4_release/">
            Release Notes
          </a>
        </li>
  
        <li class="">
          <a class="" href="/ApiDoc.html">
            libsel4 API
          </a>
        </li>
  
        <li class="">
          <a class="" href="https://sel4.systems/Info/Docs/seL4-manual-latest.pdf">
            Current Manual
          </a>
        </li>
  
        <li class="">
          <a class="" href="/VerifiedConfigurations.html">
            Verified Configurations
          </a>
        </li>
  
      </ul>

    <h3>Community</h3>
      <ul class="nav nav-sidebar">
  
        <li class="">
          <a class="" href="/Conduct.html">
            Code of Conduct
          </a>
        </li>
  
        <li class="">
          <a class="" href="/Contributing.html">
            Contributing
          </a>
        </li>
  
        <li class="">
          <a class="" href="https://research.csiro.au/tsblog">
            Trustworthy Systems Blog
          </a>
        </li>
  
        <li class="">
          <a class="" href="/IRCChannel.html">
            IRC Channel
          </a>
        </li>
  
        <li class="">
          <a class="" href="/SuggestedProjects.html">
            Suggested projects
          </a>
        </li>
  
        <li class="">
          <a class="" href="/CommunityProjects.html">
            Community Projects
          </a>
        </li>
  
      </ul>


  <h3><a href="/Tutorials">Tutorials</a></h3>
    <ul class="nav nav-sidebar">
  
  
        <li class="">
            <a class="" href="/Tutorials/hello-world.html">Hello, World!</a>
        <li>
  
        <li class="">
            <a class="" href="/Tutorials/hello-camkes-0.html">Camkes</a>
        <li>
  
        <li class="">
            <a class="" href="/Tutorials/hello-camkes-1.html">Camkes 1</a>
        <li>
  
        <li class="">
            <a class="" href="/Tutorials/hello-camkes-2.html">Camkes 2</a>
        <li>
  
        <li class="">
            <a class="" href="/Tutorials/hello-camkes-timer.html">Camkes 3</a>
        <li>
  
        <li class="">
            <a class="" href="/Tutorials/dynamic-1.html">Dynamic Libraries 1</a>
        <li>
  
        <li class="">
            <a class="" href="/Tutorials/dynamic-2.html">Dynamic Libraries 2</a>
        <li>
  
        <li class="">
            <a class="" href="/Tutorials/dynamic-3.html">Dynamic Libraries 3</a>
        <li>
  
        <li class="">
            <a class="" href="/Tutorials/dynamic-4.html">Dynamic Libraries 4</a>
        <li>
  
        <li class="">
            <a class="" href="/Tutorials/mcs.html">MCS</a>
        <li>
  
        <li class="">
            <a class="" href="/Tutorials/capabilities.html">Capabilities</a>
        <li>
  
        <li class="">
            <a class="" href="/Tutorials/untyped.html">Untyped</a>
        <li>
  
        <li class="">
            <a class="" href="/Tutorials/mapping.html">Mapping</a>
        <li>
  
        <li class="">
            <a class="" href="/Tutorials/threads.html">Threads</a>
        <li>
  
        <li class="">
            <a class="" href="/Tutorials/ipc.html">IPC</a>
        <li>
  
        <li class="">
            <a class="" href="/Tutorials/notifications.html">Notifications</a>
        <li>
  
        <li class="">
            <a class="" href="/Tutorials/interrupts.html">Interrupts</a>
        <li>
  
        <li class="">
            <a class="" href="/Tutorials/fault-handlers.html">Faults</a>
        <li>
  
        <li class="">
            <a class="" href="/Tutorials/camkes-vm-linux.html">Camkes VM Linux</a>
        <li>
  
        <li class="">
            <a class="" href="/Tutorials/camkes-vm-crossvm.html">Camkes Cross-VM communication</a>
        <li>
  
    </ul>
</div>


  </div>
  <div class="col-sm-8 col-md-9 col-lg-8 main">
    
    <div class="content">
      
<h1 id="stand-alone-sel4-builds">Stand-alone seL4 builds</h1>

<!--excerpt-->

<p>This page contains documentation for building the seL4 kernel standalone — without a userlevel or any loaders that run before the kernel. This is typically used for verification or where a project wants to fully control userlevel and prekernel initialisation. We only maintain verification configurations for kernel only builds.  This page assumes familiarity with using the seL4 project build system and builds upon the previous documentation.</p>

<!--excerpt-->

<p><em>Note: it is assumed that you know what to do with a generated kernel.elf binary.  For an explanation see at the bottom of the page.</em></p>

<h2 id="building-a-kernel-standalone">Building a kernel standalone</h2>

<h3 id="initialising-build-directory-with-existing-configuration">Initialising build directory with existing configuration</h3>

<p>Building the kernel standalone requires initialising a cmake build directory using the sel4 repo as the root CMake project:</p>
<pre><code class="language-none">├── sel4/
│   └── CMakeLists.txt
├── build/ # Current directory
</code></pre>

<p>The build directory is initialised as follows:</p>
<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cmake <span class="nt">-DCROSS_COMPILER_PREFIX</span><span class="o">=</span> <span class="nt">-DCMAKE_TOOLCHAIN_FILE</span><span class="o">=</span>../sel4/gcc.cmake <span class="nt">-G</span> Ninja <span class="nt">-C</span> ../sel4/configs/X64_verified.cmake ../sel4/
</code></pre></div></div>
<p>We use the X64_verified.cmake file for configuration values.</p>

<p>To find available verification configurations:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">ls</span> ../sel4/configs/<span class="k">*</span>.cmake
<span class="c"># ../sel4/configs/ARM_HYP_verified.cmake  ../sel4/configs/X64_verified.cmake</span>
<span class="c"># ../sel4/configs/ARM_verified.cmake</span>
</code></pre></div></div>
<p>A typical verification configuration (<code class="highlighter-rouge">cat ../sel4/configs/X64_verified.cmake</code>):</p>
<div class="language-cmake highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#</span>
<span class="c1"># Copyright 2017, Data61</span>
<span class="c1"># Commonwealth Scientific and Industrial Research Organisation (CSIRO)</span>
<span class="c1"># ABN 41 687 119 230.</span>
<span class="c1">#</span>
<span class="c1"># This software may be distributed and modified according to the terms of</span>
<span class="c1"># the GNU General Public License version 2. Note that NO WARRANTY is provided.</span>
<span class="c1"># See "LICENSE_GPLv2.txt" for details.</span>
<span class="c1">#</span>
<span class="c1"># @TAG(DATA61_GPL)</span>
<span class="c1">#</span>
<span class="nb">set</span><span class="p">(</span>KernelArch <span class="s2">"x86"</span> CACHE STRING <span class="s2">""</span><span class="p">)</span>
<span class="nb">set</span><span class="p">(</span>KernelX86Sel4Arch <span class="s2">"x86_64"</span> CACHE STRING <span class="s2">""</span><span class="p">)</span>
<span class="nb">set</span><span class="p">(</span>KernelVerificationBuild ON CACHE BOOL <span class="s2">""</span><span class="p">)</span>
<span class="nb">set</span><span class="p">(</span>KernelMaxNumNodes <span class="s2">"1"</span> CACHE STRING <span class="s2">""</span><span class="p">)</span>
<span class="nb">set</span><span class="p">(</span>KernelOptimisation <span class="s2">"-O2"</span> CACHE STRING <span class="s2">""</span><span class="p">)</span>
<span class="nb">set</span><span class="p">(</span>KernelRetypeFanOutLimit <span class="s2">"256"</span> CACHE STRING <span class="s2">""</span><span class="p">)</span>
<span class="nb">set</span><span class="p">(</span>KernelBenchmarks <span class="s2">"none"</span> CACHE STRING <span class="s2">""</span><span class="p">)</span>
<span class="nb">set</span><span class="p">(</span>KernelDangerousCodeInjection OFF CACHE BOOL <span class="s2">""</span><span class="p">)</span>
<span class="nb">set</span><span class="p">(</span>KernelFastpath ON CACHE BOOL <span class="s2">""</span><span class="p">)</span>
<span class="nb">set</span><span class="p">(</span>KernelPrinting OFF CACHE BOOL <span class="s2">""</span><span class="p">)</span>
<span class="nb">set</span><span class="p">(</span>KernelNumDomains 16 CACHE STRING <span class="s2">""</span><span class="p">)</span>
<span class="nb">set</span><span class="p">(</span>KernelMaxNumBootinfoUntypedCap 166 CACHE STRING <span class="s2">""</span><span class="p">)</span>
<span class="nb">set</span><span class="p">(</span>KernelRootCNodeSizeBits 19 CACHE STRING <span class="s2">""</span><span class="p">)</span>
<span class="nb">set</span><span class="p">(</span>KernelMaxNumBootinfoUntypedCaps 50 CACHE STRING <span class="s2">""</span><span class="p">)</span>
</code></pre></div></div>

<p>At this point you could use <code class="highlighter-rouge">ccmake ../sel4</code> to browse the configuration.</p>

<h3 id="building-the-kernel-target">Building the kernel target</h3>

<p>The kernel target needs to be specified to <code class="highlighter-rouge">ninja</code> otherwise it won’t be built.</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ninja kernel.elf
</code></pre></div></div>

<p>Looking in the build directory:</p>
<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">ls</span>
<span class="c"># autoconf                 gen_config       kernel_all_pp.c                      kernel.elf</span>
<span class="c"># build.ninja              generated        kernel_all_pp_prune.c                linker.lds_pp</span>
<span class="c"># circular_includes_valid  generated_prune  kernel_all_pp_prune_wrapper_temp.c   linker_ld_wrapper_temp.c</span>
<span class="c"># CMakeCache.txt           gen_headers      kernel_bf_gen_target_111_pbf_temp.c  rules.ninja</span>
<span class="c"># CMakeFiles               kernel_all.c     kernel_bf_gen_target_11_pbf_temp.c</span>
<span class="c"># cmake_install.cmake      kernel_all.i     kernel_bf_gen_target_1_pbf_temp.c</span>
</code></pre></div></div>

<p>The kernel.elf can now be used in other build environments.</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>file kernel.elf
<span class="c"># kernel.elf: ELF 64-bit LSB executable, x86-64, version 1 (SYSV), statically linked, not stripped</span>
</code></pre></div></div>

<h2 id="why-use-stand-alone-build">Why use stand alone build?</h2>

<p>It is non-trivial to take a standalone kernel.elf and use it in another build environment.  This is because the system configuration is not exported with the kernel.elf and so a different build environment will need to know exactly how the kernel was configured so that bootloaders and userlevel applications can be configured in a compatible way.  Using the CMake scripts provided in seL4_tools and importing the kernel into an existing CMake project hierarchy will ensure that the system configuration is properly shared with other parts of the project.</p>

<p>However sometimes a standalone build is required when the kernel is being used in a different environment that doesn’t use a CMake based build system.  One example of this is the verification project, L4V, that uses the stand alone build to poroduce the source and binary artifacts that the verification is performed on.</p>

<p>Other use cases include projects that want to build a non-C roottask, or projects that are already sophisticated enough to manage the different configuration settings that the kernel requires.  In these scenarios, it would be expected that these projects provide their own Configuration.cmake files that have correct configurations.</p>

    </div>
  </div>
</div>

    </main>
    

<footer class="site-footer">

  <h2 class="footer-heading">seL4 docs</h2>

  <div class="footer-col-wrapper">

    <div class="col-md-2">
      

<ul class="social-media-list">
  <li><a href="https://github.com/sel4"><i class="fab fa-github"></i> <span class="username">sel4</span></a></li><li><a href="https://github.com/sel4proj"><i class="fab fa-github"></i> <span class="username">sel4proj</span></a></li>
</ul>

    </div>

    <div class="col-md-8">
      <ul class="list-unstyled">
        <li>
          This site is for displaying seL4 related documentation.  Pull requests are welcome.
        </li>
        
          <li>
            Site last updated: Tue Oct 22 16:54:43 2019 +1100 5536579
          </li>
          <li>
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
                Page last updated: Mon May 28 16:30:11 2018 +1000 e6ed397
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
          </li>
        
      </ul>
    </div>
    <div class="col-md-2">
      <a href="https://github.com/SEL4PROJ/docs/blob/master/Developing/Building/seL4Standalone.md">View page on GitHub</a>
      <br />
      <a href="https://github.com/SEL4PROJ/docs/edit/master/Developing/Building/seL4Standalone.md">Edit page on GitHub</a>
      <br />
      <a href="/sitemap">Sitemap</a>
    </div>

  </div>

</footer>
  </body>
</html>
